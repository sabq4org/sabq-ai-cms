# إعداد نظام التحقق عبر البريد الإلكتروني

تم إعداد نظام التحقق عبر البريد الإلكتروني لعملية التسجيل في منصة سبق. هذا المستند يشرح كيفية إعداد وتكوين النظام.

## الإعدادات المستخدمة

### خادم البريد الصادر (SMTP)
- **الخادم**: smtp.gmail.com
- **المنفذ**: 465
- **SSL**: ✅ نعم
- **اسم المستخدم**: ai@sabq.org
- **كلمة المرور**: MyY&RXSne=Wb2gM>

### خادم البريد الوارد (IMAP)
- **الخادم**: imap.gmail.com
- **المنفذ**: 993
- **SSL**: ✅ نعم
- **اسم المستخدم**: ai@sabq.org
- **كلمة المرور**: MyY&RXSne=Wb2gM>

## التغييرات التي تم إجراؤها

1. **تحديث إعدادات البريد الإلكتروني**:
   - تم تعديل ملف `lib/email-config-fix.ts` لاستخدام خادم Gmail مع الإعدادات الصحيحة.

2. **إنشاء ملف إعدادات البريد**:
   - تم إنشاء ملف `email-settings.txt` يحتوي على متغيرات البيئة المطلوبة.
   - يجب نسخ محتويات هذا الملف إلى ملف `.env.local` أو `.env` لتفعيل الإعدادات.

3. **تحسين معالجة الأخطاء في التسجيل**:
   - تم تحسين معالجة الأخطاء في ملف `app/api/auth/register/route.ts` لتوفير معلومات أكثر تفصيلاً عن عملية إرسال البريد.

4. **إنشاء سكريبت اختبار**:
   - تم إنشاء ملف `scripts/test-email-verification.js` لاختبار إرسال بريد التحقق.

## كيفية الاختبار

1. **إضافة متغيرات البيئة**:
   ```bash
   # نسخ الإعدادات إلى ملف .env.local
   cp email-settings.txt .env.local
   ```

2. **اختبار إرسال بريد التحقق**:
   ```bash
   # تعديل البريد المستلم في الملف
   nano scripts/test-email-verification.js
   
   # تشغيل سكريبت الاختبار
   node scripts/test-email-verification.js
   ```

3. **اختبار عملية التسجيل**:
   - قم بالتسجيل في الموقع باستخدام بريد إلكتروني حقيقي
   - تحقق من وصول بريد التحقق
   - استخدم الرمز للتحقق من حسابك

## ملاحظات هامة

1. **أمان كلمة المرور**:
   - تأكد من تغيير كلمة المرور بشكل دوري
   - لا تقم بمشاركة كلمة المرور في الكود المصدري العام

2. **إعدادات Gmail**:
   - تأكد من تفعيل "وصول التطبيقات الأقل أماناً" في إعدادات Gmail أو استخدام "كلمة مرور التطبيق"
   - قد تحتاج إلى تأكيد الوصول من جهاز جديد عند أول استخدام

3. **تخطي التحقق في بيئة التطوير**:
   - يمكنك تعيين `SKIP_EMAIL_VERIFICATION=true` في بيئة التطوير لتخطي عملية التحقق

## استكشاف الأخطاء وإصلاحها

إذا واجهت مشاكل في إرسال بريد التحقق، تحقق من:

1. **اتصال الإنترنت**: تأكد من وجود اتصال بالإنترنت

2. **إعدادات الخادم**: تأكد من صحة إعدادات SMTP و IMAP

3. **سجلات الخطأ**: راجع سجلات الخطأ في وحدة التحكم

4. **تفعيل وضع التصحيح**: قم بتعيين `EMAIL_DEBUG=true` للحصول على معلومات أكثر تفصيلاً

5. **اختبار الاتصال**: استخدم سكريبت الاختبار للتحقق من الاتصال بخادم البريد

## المراجع

- [توثيق Nodemailer](https://nodemailer.com/about/)
- [إعدادات SMTP لـ Gmail](https://support.google.com/mail/answer/7126229)
- [إعدادات IMAP لـ Gmail](https://support.google.com/mail/answer/7126229)