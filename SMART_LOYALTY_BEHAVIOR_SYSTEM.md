# ๐ฏ ูุธุงู ุงูููุงุก ูุงูุชุชุจุน ุงูุฐูู - ุฏููู ุงูุชุทุจูู ุงูุดุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุชูุงูู ููููุงุก ูุชุชุจุน ุงูุณููู ุงูุฐูู ูููุตุฉ "ุณุจู ุงูุฐููุฉ" ููุฏู ุฅูู:
- **ุชุชุจุน ุดุงูู** ูุฌููุน ุชูุงุนูุงุช ุงููุณุชุฎุฏููู
- **ููุญ ููุงุท ุชููุงุฆูุฉ** ููู ูุดุงุท ูููู ุจู ุงููุณุชุฎุฏู
- **ุชูุตูุงุช ูุฎุตุตุฉ** ุจูุงุกู ุนูู ุงูุณููู ูุงูุงูุชูุงูุงุช
- **ุชุญููู ุฐูู** ูุฃููุงุท ุงูุงุณุชุฎุฏุงู ูุงูุชูุถููุงุช

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ุงูููููุงุช ุงูุฃุณุงุณูุฉ

#### 1. ูุธุงู ุงูููุงุก (`LoyaltySystem`)
**ุงูููู:** `lib/services/loyalty-system.ts`

**ุงูููุฒุงุช:**
- โ **25+ ููุน ูุดุงุท** ูุน ููุงุท ูุฎุชููุฉ
- โ **5 ูุณุชููุงุช ููุงุก** ูุชุฏุฑุฌุฉ
- โ **ูุธุงู Cooldown** ูููุน ุงูุชูุงุนุจ
- โ **ุฅูุฌุงุฒุงุช ุชููุงุฆูุฉ** ูููุนุงูู ุงููููุฉ
- โ **ุชุชุจุน ุดุงูู** ูููุนุงููุงุช

**ุฃููุงุน ุงูุฃูุดุทุฉ ูุงูููุงุท:**
```typescript
const LOYALTY_ACTIONS = {
  'article_read': { points: 5, description: 'ูุฑุงุกุฉ ููุงู ูุงูู' },
  'article_like': { points: 3, description: 'ุฅุนุฌุงุจ ุจููุงู' },
  'article_share': { points: 8, description: 'ูุดุงุฑูุฉ ููุงู' },
  'deep_read': { points: 15, description: 'ูุฑุงุกุฉ ุนูููุฉ (ุฃูุซุฑ ูู 3 ุฏูุงุฆู)' },
  'daily_visit': { points: 5, description: 'ุฒูุงุฑุฉ ููููุฉ' },
  // ... 20+ ูุดุงุท ุฅุถุงูู
};
```

**ูุณุชููุงุช ุงูููุงุก:**
1. **ูุจุชุฏุฆ** (0-99 ููุทุฉ) - ุฅุดุนุงุฑุงุช ุฃุณุงุณูุฉ
2. **ูุดุท** (100-299 ููุทุฉ) - ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ + ูุญุชูู ููุชุฑุญ
3. **ูุฎูุต** (300-699 ููุทุฉ) - ูุญุชูู ุญุตุฑู + ุฃููููุฉ ุชุนูููุงุช
4. **ุฎุจูุฑ** (700-1499 ููุทุฉ) - ูุตูู ูุจูุฑ + ุดุงุฑุฉ ุฎุงุตุฉ
5. **ุณููุฑ** (1500+ ููุทุฉ) - ุฌููุน ุงููุฒุงูุง + ูุญุชูู VIP

#### 2. ูุชุชุจุน ุงูุณููู (`BehaviorTracker`)
**ุงูููู:** `lib/services/behavior-tracker.ts`

**ุงูููุฒุงุช:**
- โ **ุชุชุจุน ุดุงูู** ููุชูุงุนูุงุช
- โ **ุชุญููู ุงูุงูุชูุงูุงุช** ุงูุชููุงุฆู
- โ **ูุญุฑู ุงูุชูุตูุงุช** ุงูุฐูู
- โ **ุชุญููู ุฃููุงุท ุงูุณููู** ุงููุชูุฏู

**ุงูุจูุงูุงุช ุงููุชุชุจุนุฉ:**
- ุงูููุช ุงูููุถู ูู ูู ุตูุญุฉ
- ุนูู ุงูุชูุฑูุฑ ูุงููุฑุงุกุฉ
- ุงูููุฑุงุช ูุงูุชูุงุนูุงุช
- ุฃููุงุช ุงููุดุงุท ุงูููุถูุฉ
- ุงููุฆุงุช ูุงูููุงุถูุน ุงูููุถูุฉ

#### 3. ุณูุฑูุจุช ุงูุชุชุจุน ุงูุฃูุงูู
**ุงูููู:** `public/js/behavior-tracker-client.js`

**ุงูููุฒุงุช:**
- โ **ุชุชุจุน ูู ุงูููุช ุงููุนูู** ูุฌููุน ุงูุฃูุดุทุฉ
- โ **ุฅุดุนุงุฑุงุช ููุฑูุฉ** ูููุญ ุงูููุงุท
- โ **ุชุชุจุน ุฐูู** ูููุฑุงุกุฉ ุงูุนูููุฉ
- โ **ูุฒุงููุฉ ุฏูุฑูุฉ** ููุจูุงูุงุช
- โ **ุฅุดุนุงุฑุงุช ุชุฑููุฉ ุงููุณุชูู**

---

## ๐ ุงูุชุทุจูู ุงูุนููู

### 1. ุฅุนุฏุงุฏ ุงููุธุงู ูู ุงูุชุทุจูู

#### ุฃ) ุฏูุฌ ูุฒูุฏ ุงูุชุชุจุน
```tsx
import BehaviorTrackingProvider from '@/components/tracking/BehaviorTrackingProvider';

function App() {
  return (
    <BehaviorTrackingProvider userId={currentUser?.id}>
      {/* ูุญุชูู ุงูุชุทุจูู */}
    </BehaviorTrackingProvider>
  );
}
```

#### ุจ) ุงุณุชุฎุฏุงู ุงูุชุฎุทูุท ุงูุฐูู
```tsx
import SmartTrackingLayout from '@/components/layout/SmartTrackingLayout';

function ArticlePage() {
  return (
    <SmartTrackingLayout
      userId={userId}
      showLoyaltyWidget={true}
      showRecommendations={true}
    >
      {/* ูุญุชูู ุงูููุงู */}
    </SmartTrackingLayout>
  );
}
```

#### ุฌ) ุนุฑุถ ูููู ุงูููุงุก
```tsx
import LoyaltyWidget from '@/components/loyalty/LoyaltyWidget';

<LoyaltyWidget 
  userId={userId}
  showDetails={true}
  className="w-full max-w-sm"
/>
```

#### ุฏ) ุนุฑุถ ุงูุชูุตูุงุช ุงููุฎุตุตุฉ
```tsx
import PersonalizedRecommendations from '@/components/personalization/PersonalizedRecommendations';

<PersonalizedRecommendations
  userId={userId}
  limit={10}
  showInsights={true}
/>
```

### 2. ุงุณุชุฎุฏุงู Hook ุงูุชุชุจุน

```tsx
import { useSmartTracking } from '@/components/layout/SmartTrackingLayout';

function MyComponent() {
  const { trackEvent, awardPoints, isReady } = useSmartTracking(userId);
  
  const handleLike = () => {
    awardPoints('article_like', articleId);
  };
  
  const handleCustomEvent = () => {
    trackEvent('custom_interaction', { 
      type: 'button_click',
      location: 'header'
    });
  };
}
```

---

## ๐ API Endpoints

### ูุธุงู ุงูููุงุก

#### ููุญ ุงูููุงุท
```http
POST /api/loyalty/award
Content-Type: application/json

{
  "userId": "user_123",
  "actionType": "article_read",
  "contentId": "article_456",
  "metadata": {
    "sessionId": "session_789",
    "pageUrl": "/article/456"
  }
}
```

#### ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
```http
GET /api/loyalty/stats/user_123
```

#### ุงูุฒูุงุฑุฉ ุงูููููุฉ
```http
POST /api/loyalty/daily-visit
Content-Type: application/json

{
  "userId": "user_123"
}
```

### ุชุชุจุน ุงูุณููู

#### ุชุณุฌูู ุญุฏุซ ูุงุญุฏ
```http
POST /api/behavior/track
Content-Type: application/json

{
  "userId": "user_123",
  "sessionId": "session_789",
  "eventType": "page_view",
  "pageUrl": "/article/456",
  "contentId": "456",
  "contentCategory": "ุชูููุฉ",
  "timeSpent": 120,
  "scrollDepth": 75,
  "clickCount": 3
}
```

#### ุชุณุฌูู ุฃุญุฏุงุซ ูุชุนุฏุฏุฉ
```http
POST /api/behavior/batch
Content-Type: application/json

{
  "events": [
    { /* ุญุฏุซ 1 */ },
    { /* ุญุฏุซ 2 */ },
    // ... ุญุชู 100 ุญุฏุซ
  ]
}
```

#### ุงูุชูุตูุงุช ุงููุฎุตุตุฉ
```http
GET /api/behavior/recommendations/user_123?limit=10
```

---

## ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ (ููุฌูุฏุฉ ูุณุจูุงู)

#### `users`
- `loyalty_points`: ุฅุฌูุงูู ุงูููุงุท
- `interests`: ูุงุฆูุฉ ุงูุงูุชูุงูุงุช (JSON)

#### `LoyaltyTransactions`
- ุชุณุฌูู ุฌููุน ูุนุงููุงุช ุงูููุงุท
- ุฑุจุท ุจุงููุณุชุฎุฏู ูุงููุญุชูู
- ุจูุงูุงุช ูุตููุฉ ุดุงููุฉ

#### `UserInteractions`
- ุชุณุฌูู ุฌููุน ุงูุชูุงุนูุงุช
- ุฑุจุท ุจุงูุฌูุณุงุช ูุงููุญุชูู
- ููุงุท ููุชุณุจุฉ ููู ุชูุงุนู

#### `UserDetailedPreferences`
- ุชุฎุฒูู ุงูุงูุชูุงูุงุช ุงูููุตูุฉ
- ููุงุท ููู ูุฆุฉ ุงูุชูุงู
- ุนุฏุงุฏ ุงูุชูุงุนูุงุช

#### `UserSessions`
- ุชุชุจุน ุฌูุณุงุช ุงููุณุชุฎุฏููู
- ูุนูููุงุช ุงูุฌูุงุฒ ูุงููููุน
- ุฃููุงุช ุงููุดุงุท

#### `UserRecommendations`
- ุงูุชูุตูุงุช ุงููููุฏุฉ
- ููุงุท ุงูุซูุฉ ูุงูุฃุณุจุงุจ
- ุชุชุจุน ุงูููุฑุงุช ูุงูุชูุงุนู

---

## ๐ฏ ุงูููุฒุงุช ุงููุชูุฏูุฉ

### 1. ุงูุชุชุจุน ุงูุฐูู ูููุฑุงุกุฉ
- **ูุฑุงุกุฉ ุนูููุฉ**: ุฃูุซุฑ ูู 3 ุฏูุงุฆู = 15 ููุทุฉ
- **ูุฑุงุกุฉ ูุงููุฉ**: ุงูุชูุฑูุฑ ูุฃูุซุฑ ูู 90% = 7 ููุงุท
- **ุชุชุจุน ุงููุดุงุท**: ูุญุต ูุดุงุท ุงููุณุชุฎุฏู ูู 30 ุซุงููุฉ

### 2. ููุน ุงูุชูุงุนุจ
- **ูุชุฑุงุช ุงูุชุธุงุฑ**: ููู ููุน ูุดุงุท ูุชุฑุฉ ุงูุชุธุงุฑ ูุฎุชููุฉ
- **ูุญุต ุงูุชูุฑุงุฑ**: ููุน ููุญ ููุงุท ูุชูุฑุฑุฉ ูููุดุงุท ููุณู
- **ุชุชุจุน ุงูุฌูุณุงุช**: ุฑุจุท ุงูุฃูุดุทุฉ ุจุฌูุณุงุช ุญููููุฉ

### 3. ุงูุฅูุฌุงุฒุงุช ุงูุชููุงุฆูุฉ
- **ุฃูู ููุงู**: 20 ููุทุฉ
- **10 ููุงูุงุช**: 50 ููุทุฉ
- **50 ููุงู**: 150 ููุทุฉ
- **100 ููุงู**: 300 ููุทุฉ
- **ุฃูู ุชุนููู**: 25 ููุทุฉ
- **ุฃูู ูุดุงุฑูุฉ**: 15 ููุทุฉ

### 4. ุงูุชูุตูุงุช ุงูุฐููุฉ
- **ุชุญููู ุงูุงูุชูุงูุงุช**: ุจูุงุกู ุนูู ุงูุชูุงุนูุงุช ุงููุนููุฉ
- **ุนูุงูู ูุชุนุฏุฏุฉ**: ุงูุญุฏุงุซุฉ + ุงูุดุนุจูุฉ + ุงูุชููุน + ุงูุงูุชูุงู
- **ุชุญุฏูุซ ูุณุชูุฑ**: ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุงูุชูุงูุงุช ูุน ูู ุชูุงุนู

---

## ๐ง ุงูุชุฎุตูุต ูุงูุฅุนุฏุงุฏุงุช

### ุชุฎุตูุต ุงูููุงุท
```typescript
// ูู lib/services/loyalty-system.ts
const LOYALTY_ACTIONS = {
  'custom_action': { 
    points: 10, 
    description: 'ูุดุงุท ูุฎุตุต',
    cooldown: 300 // 5 ุฏูุงุฆู
  }
};
```

### ุชุฎุตูุต ุงููุณุชููุงุช
```typescript
const LOYALTY_LEVELS = [
  { 
    name: 'ูุณุชูู ูุฎุตุต', 
    minPoints: 2000, 
    maxPoints: null,
    benefits: ['ููุฒุฉ ุฎุงุตุฉ', 'ูุตูู VIP']
  }
];
```

### ุชุฎุตูุต ุงูุชูุตูุงุช
```typescript
// ูู calculateRecommendationScore
const customScore = userInterest.score * 0.5 + // 50% ุงูุชูุงู
                   recencyScore * 0.3 +        // 30% ุญุฏุงุซุฉ
                   popularityScore * 0.2;      // 20% ุดุนุจูุฉ
```

---

## ๐ ุงููุฑุงูุจุฉ ูุงูุชุญูููุงุช

### ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ

#### ูุธุงู ุงูููุงุก
- **ูุชูุณุท ุงูููุงุท ุงูููููุฉ** ููู ูุณุชุฎุฏู
- **ูุนุฏู ุชุฑููุฉ ุงููุณุชููุงุช**
- **ุชูุฒูุน ุงููุณุชุฎุฏููู** ุนูู ุงููุณุชููุงุช
- **ุฃูุซุฑ ุงูุฃูุดุทุฉ** ุชุญููุฒุงู ููููุงุท

#### ุชุชุจุน ุงูุณููู
- **ูุชูุณุท ูุฏุฉ ุงูุฌูุณุฉ**
- **ูุนุฏู ุงูุชูุงุนู** ูุน ุงูุชูุตูุงุช
- **ุฏูุฉ ุงูุชูุตูุงุช** (ูุณุจุฉ ุงูููุฑ)
- **ุชููุน ุงูุงูุชูุงูุงุช** ููู ูุณุชุฎุฏู

### ุงุณุชุนูุงูุงุช ูููุฏุฉ

#### ุฃูุซุฑ ุงููุณุชุฎุฏููู ูุดุงุทุงู
```sql
SELECT u.id, u.name, u.loyalty_points, COUNT(lt.id) as transactions
FROM users u
LEFT JOIN LoyaltyTransactions lt ON u.id = lt.user_id
WHERE lt.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY u.id
ORDER BY u.loyalty_points DESC
LIMIT 10;
```

#### ุฃูุซุฑ ุงูุฃูุดุทุฉ ุดููุนุงู
```sql
SELECT 
  JSON_EXTRACT(metadata, '$.action_type') as action_type,
  COUNT(*) as count,
  SUM(points) as total_points
FROM LoyaltyTransactions
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY action_type
ORDER BY count DESC;
```

#### ูุนุงููุฉ ุงูุชูุตูุงุช
```sql
SELECT 
  ur.model_id,
  COUNT(*) as total_recommendations,
  COUNT(ur.clicked_items) as clicked_recommendations,
  (COUNT(ur.clicked_items) / COUNT(*)) * 100 as click_rate
FROM UserRecommendations ur
WHERE ur.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY ur.model_id;
```

---

## ๐จ ุงูุฃูุงู ูุงูุฎุตูุตูุฉ

### ุญูุงูุฉ ุงูุจูุงูุงุช
- โ **ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ**
- โ **ููุชุฑุฉ ุงููุฏุฎูุงุช** ูููุน SQL Injection
- โ **ุชุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช** ูููุน ุงูุฅุณุงุกุฉ
- โ **ุชุณุฌูู ุงูุนูููุงุช** ูููุฑุงุฌุนุฉ

### ุงูุฎุตูุตูุฉ
- โ **ุฅุฎูุงุก ูููุฉ ุงูุจูุงูุงุช** ูู ุงูุชุญูููุงุช
- โ **ุฎูุงุฑ ุฅููุงู ุงูุชุชุจุน** ูููุณุชุฎุฏููู
- โ **ุญุฐู ุงูุจูุงูุงุช** ุนูุฏ ุทูุจ ุงููุณุชุฎุฏู
- โ **ุดูุงููุฉ ูู ุฌูุน ุงูุจูุงูุงุช**

### ุฃูุถู ุงูููุงุฑุณุงุช
```typescript
// ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช
if (!userId || !actionType) {
  return { success: false, message: 'ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ' };
}

// ุชุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช
const rateLimited = await checkRateLimit(userId, 'loyalty_award');
if (rateLimited) {
  return { success: false, message: 'ุชุฌุงูุฒ ุงูุญุฏ ุงููุณููุญ' };
}
```

---

## ๐ ุงูุชุทููุฑ ุงููุณุชูุจูู

### ุงูููุฒุงุช ุงููุฎุทุทุฉ
- [ ] **ุชุญููู ุงููุดุงุนุฑ** ููุชุนูููุงุช ูุงูุชูุงุนูุงุช
- [ ] **ุชูุตูุงุช ูุชูุฏูุฉ** ุจุงุณุชุฎุฏุงู ML
- [ ] **ูุธุงู ุดุงุฑุงุช** ููุฅูุฌุงุฒุงุช ุงูุฎุงุตุฉ
- [ ] **ูุณุงุจูุงุช ูุชุญุฏูุงุช** ุฏูุฑูุฉ
- [ ] **ูุธุงู ุฅุญุงูุฉ** ููุฃุตุฏูุงุก
- [ ] **ุชูุงูู ูุน ูุณุงุฆู ุงูุชูุงุตู** ุงูุงุฌุชูุงุนู

### ุงูุชุญุณููุงุช ุงูุชูููุฉ
- [ ] **ุชุญุณูู ุงูุฃุฏุงุก** ููุงุณุชุนูุงูุงุช ุงููุจูุฑุฉ
- [ ] **ุชุฎุฒูู ูุคูุช ุฐูู** ููุชูุตูุงุช
- [ ] **ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ** ูู ุงูููุช ุงููุนูู
- [ ] **ููุญุฉ ุชุญูู ุชุญููููุฉ** ูุชูุฏูุฉ
- [ ] **ุงุฎุชุจุงุฑุงุช A/B** ููููุฒุงุช ุงูุฌุฏูุฏุฉ

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

### ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง

#### 1. ูุง ูุนูู ุงูุชุชุจุน
```javascript
// ุชุญูู ูู ุชุญููู ุงูุณูุฑูุจุช
if (!window.behaviorTracker) {
  console.error('ุณูุฑูุจุช ุงูุชุชุจุน ุบูุฑ ูุญูู');
}

// ุชุญูู ูู ูุนุฑู ุงููุณุชุฎุฏู
if (!window.userId) {
  console.error('ูุนุฑู ุงููุณุชุฎุฏู ุบูุฑ ูุชููุฑ');
}
```

#### 2. ูุง ุชุธูุฑ ุงูููุงุท
```typescript
// ุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฑุณูุฉ
const response = await fetch('/api/loyalty/award', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userId: 'valid_user_id',
    actionType: 'valid_action_type'
  })
});

console.log(await response.json());
```

#### 3. ุงูุชูุตูุงุช ุบูุฑ ุฏูููุฉ
```sql
-- ูุญุต ุจูุงูุงุช ุงูุงูุชูุงูุงุช
SELECT * FROM UserDetailedPreferences 
WHERE user_id = 'user_123' 
AND preference_key LIKE 'interest_%';

-- ูุญุต ุงูุชูุงุนูุงุช ุงูุฃุฎูุฑุฉ
SELECT * FROM UserInteractions 
WHERE user_id = 'user_123' 
ORDER BY created_at DESC 
LIMIT 10;
```

### ูุนูููุงุช ุงูุงุชุตุงู
- **ุงููุทูุฑ**: ูุฑูู ุณุจู ุงูุฐููุฉ
- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: dev@sabq.org
- **ุงูุชูุซูู**: `/docs/smart-tracking`
- **ุงูุฏุนู ุงูููู**: `/support/tracking-system`

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ูุชูุงูู ูุฐูู ููููุงุก ูุชุชุจุน ุงูุณููู ูููุฑ:

โ **ุชุชุจุน ุดุงูู** ูุฌููุน ุฃูุดุทุฉ ุงููุณุชุฎุฏููู  
โ **ูุธุงู ููุงุท ูุชูุฏู** ูุน 25+ ููุน ูุดุงุท  
โ **ุชูุตูุงุช ูุฎุตุตุฉ** ุจูุงุกู ุนูู ุงูุณููู ุงููุนูู  
โ **ูุงุฌูุงุช ุณููุฉ ุงูุงุณุชุฎุฏุงู** ููุชุฌุงูุจุฉ  
โ **ุฃูุงู ูุฎุตูุตูุฉ** ุนุงููุฉ ุงููุณุชูู  
โ **ูุงุจููุฉ ุงูุชูุณุน** ูุงูุชุฎุตูุต  

ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ ููููู ุชุทุจููู ููุฑุงู ูุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏููู ูุฒูุงุฏุฉ ุงูุชูุงุนู ุจุดูู ูุจูุฑ! ๐
