# أفضل الممارسات لاستخدام GPT في نظام التحليل العميق

## 1. إعداد البرومبتات

### أ. البرومبت الأساسي
```
المطلوب: نص تحليلي صحفي مكتوب بلغة عربية فصحى احترافية، منسق بعناوين وفقرات، بدون أي أكواد أو رموز برمجية.
```

### ب. هيكل التحليل المطلوب
- **مقدمة تحليلية**: تمهيد يوضح أهمية الموضوع
- **محاور التحليل**: الأقسام الرئيسية للموضوع
- **البيانات والأرقام**: إحصائيات داعمة
- **نقاط ختامية**: خلاصة التحليل
- **توصيات عملية**: خطوات تنفيذية

## 2. معالجة الأخطاء

### أ. التحقق من الاستجابة
```javascript
// التحقق من وجود محتوى
if (!response || Object.keys(response).length === 0) {
  throw new Error('رد فارغ من GPT');
}

// التحقق من المحتوى الأساسي
if (!response.title || !response.sections || response.sections.length === 0) {
  throw new Error('المحتوى غير كافٍ');
}
```

### ب. رسائل الخطأ الواضحة
- استخدم رسائل باللغة العربية
- اشرح المشكلة بوضوح
- قدم اقتراحات للحل

## 3. تحسين جودة المخرجات

### أ. معايير الجودة
- **الطول**: 1500-2500 كلمة للتحليل المتوسط
- **التنسيق**: عناوين واضحة وفقرات منظمة
- **المحتوى**: معلومات دقيقة ومحدثة
- **اللغة**: عربية فصحى سليمة

### ب. التحقق من الجودة
```javascript
function calculateQualityScore(content) {
  // التحقق من وجود الأقسام المطلوبة
  // التحقق من طول المحتوى
  // التحقق من وجود البيانات والتوصيات
  return score;
}
```

## 4. إدارة التكاليف

### أ. تحسين استخدام التوكنز
- حدد max_tokens بشكل مناسب (4000 للتحليل العميق)
- استخدم temperature مناسبة (0.7 للتوازن بين الإبداع والدقة)
- تجنب الطلبات المتكررة غير الضرورية

### ب. حساب التكلفة
```javascript
// GPT-4 pricing
const pricePerToken = 0.045 / 1000; // متوسط السعر
const cost = tokens * pricePerToken;
```

## 5. تحسين تجربة المستخدم

### أ. المعاينة المباشرة
- أضف زر معاينة/تحرير
- اعرض المحتوى بتنسيق Markdown
- دعم التنسيقات الأساسية

### ب. حفظ المفتاح بأمان
```javascript
// حفظ في localStorage (للواجهة الأمامية فقط)
localStorage.setItem('openai_api_key', encryptedKey);

// استخدام متغيرات البيئة (للإنتاج)
OPENAI_API_KEY=sk-...
```

## 6. نصائح للاستخدام الأمثل

### أ. عند توليد من مقال
- تأكد من وضوح المقال الأصلي
- أضف سياق إضافي إذا لزم الأمر
- حدد نوع التحليل المطلوب

### ب. عند توليد من موضوع
- كن محدداً في وصف الموضوع
- اختر التصنيف المناسب
- أضف كلمات مفتاحية ذات صلة

### ج. التعامل مع المصادر الخارجية
- تحقق من موثوقية المصدر
- لخص المحتوى الأساسي
- أضف السياق المحلي

## 7. استكشاف الأخطاء وحلها

### المشكلة: "رد فارغ من GPT"
**الحل**: 
- تحقق من صحة مفتاح API
- تأكد من وضوح البرومبت
- حاول مرة أخرى

### المشكلة: "المحتوى بصيغة JSON"
**الحل**:
- تحقق من دالة formatAnalysisContent
- تأكد من معالجة الاستجابة بشكل صحيح

### المشكلة: "خطأ 401 - Unauthorized"
**الحل**:
- تحقق من مفتاح API
- تأكد من عدم انتهاء صلاحيته
- استخدم مفتاح جديد إذا لزم الأمر 