# ๐๏ธ **ุญู ูุดููุฉ ุงูุฅุดุนุงุฑุงุช ููุฃุฎุจุงุฑ ุงููุญุฐููุฉ - ุชูุฑูุฑ ุดุงูู**

## ๐ **ุงููุดููุฉ ุงูุฃุตููุฉ:**
- ุงููุณุชุฎุฏู ูุชููู ุฅุดุนุงุฑุงุช ูุฃุฎุจุงุฑ ุชู ุญุฐููุง ูู ุณุงุนุงุช
- ุงููุธุงู ููุดุฆ ุฅุดุนุงุฑุงุช ุนูุฏ ูุดุฑ ุงูููุงู ููู ูุง ูุญุฐููุง ุนูุฏ ุญุฐู ุงูููุงู
- ุชุฑุงูู ุฅุดุนุงุฑุงุช "ููุชุฉ" ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐๏ธ **ุงูุญููู ุงููุทุจูุฉ:**

### 1. **ุชุญุฏูุซ API ุญุฐู ุงูููุงูุงุช:**
```typescript
// ูู /app/api/articles/[id]/route.ts
// ๐๏ธ ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฑุชุจุทุฉ ุจุงูููุงู - ููู ุฌุฏุงู!
const deletedNotifications = await prisma.smartNotifications.deleteMany({
  where: {
    OR: [
      { data: { path: ['articleId'], equals: id } },
      { data: { path: ['entityId'], equals: id } },
      { data: { path: ['link'], string_contains: article.slug } }
    ]
  }
});

console.log(`๐ ุชู ุญุฐู ${deletedNotifications.count} ุฅุดุนุงุฑุงุช ูุฑุชุจุทุฉ ุจุงูููุงู`);
```

### 2. **ุชุญุณูู ุงููุญุฑู ุงูุฐูู ููุฅุดุนุงุฑุงุช:**
```typescript
// ูู /lib/notifications/smart-engine.ts
static async notifyNewArticleInCategory(articleId: string, categoryId: string) {
  // โ ุงูุชุญูู ูู ุตุญุฉ ุงูููุงู ูุจู ุฅูุดุงุก ุงูุฅุดุนุงุฑ
  const article = await prisma.articles.findUnique({ where: { id: articleId } });
  
  if (!article) {
    console.log('โ๏ธ ุงูููุงู ุบูุฑ ููุฌูุฏุ ุฅูุบุงุก ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช');
    return;
  }
  
  if (article.status !== 'published') {
    console.log(`โ๏ธ ุงูููุงู ุบูุฑ ููุดูุฑ (${article.status})ุ ุฅูุบุงุก ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช`);
    return;
  }
  
  if (!article.slug) {
    console.log('โ๏ธ ุงูููุงู ุจุฏูู slugุ ุฅูุบุงุก ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช');
    return;
  }
  
  // ... ุจุงูู ููุทู ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช
}
```

### 3. **ูููุฉ ุชูุธูู ุฏูุฑูุฉ (Cron Job):**
```typescript
// /app/api/cron/cleanup-notifications/route.ts
// ุชูุธูู ูู ุณุงุนุฉ ููุฅุดุนุงุฑุงุช ุงูููุณูุฑุฉ
export async function GET(req: NextRequest) {
  // ูุญุต ุฌููุน ุงูุฅุดุนุงุฑุงุช
  // ุญุฐู ุงูุฅุดุนุงุฑุงุช ููููุงูุงุช ุงููุญุฐููุฉ
  // ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงูุชุฌุฑูุจูุฉ
  // ุฅุญุตุงุฆูุงุช ููุตูุฉ
}
```

### 4. **ุชุญุฏูุซ ุฃุฏุงุฉ ุงูุชูุธูู ุงููุฏููุฉ:**
```typescript
// /app/api/test-notifications/cleanup/route.ts ูุญุฏุซุฉ ุจุงููุนู
// ุชุนูู ุจุดูู ูุซุงูู ูุฅุฒุงูุฉ ุงูุฅุดุนุงุฑุงุช ุงูููุณูุฑุฉ ููุฑุงู
```

## ๐ **ุงููุชุงุฆุฌ:**

### ูุจู ุงูุญู:
- โ ุฅุดุนุงุฑุงุช ุชุชุฑุงูู ููุฃุฎุจุงุฑ ุงููุญุฐููุฉ
- โ ุงููุณุชุฎุฏููู ูุชูููู ุฅุดุนุงุฑุงุช ูุฑูุงุจุท ููุณูุฑุฉ
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชูุชูุฆ ุจุฅุดุนุงุฑุงุช ุบูุฑ ูููุฏุฉ

### ุจุนุฏ ุงูุญู:
- โ ุญุฐู ุชููุงุฆู ููุฅุดุนุงุฑุงุช ุนูุฏ ุญุฐู ุงูููุงู
- โ ูุญุต ุตุญุฉ ุงูููุงู ูุจู ุฅูุดุงุก ุงูุฅุดุนุงุฑ
- โ ุชูุธูู ุฏูุฑู ูู ุณุงุนุฉ
- โ ุฃุฏูุงุช ุชูุธูู ูุฏููุฉ ูุญุณูุฉ

## ๐ง **ููููุฉ ุนูู ุงูุญูุงูุฉ ุงูุฌุฏูุฏุฉ:**

### ุฃ. **ุนูุฏ ุญุฐู ููุงู:**
1. ุงููุธุงู ูุญุฐู ุงูููุงู ูู ุฌุฏูู `articles`
2. ูุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงููุฑุชุจุทุฉ ุจู ุชููุงุฆูุงู
3. ูุณุฌู ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฐููุฉ

### ุจ. **ุนูุฏ ุฅูุดุงุก ุฅุดุนุงุฑ:**
1. ุงูุชุญูู ูู ูุฌูุฏ ุงูููุงู
2. ุงูุชุญูู ูู ุญุงูุฉ ุงููุดุฑ (`published`)
3. ุงูุชุญูู ูู ูุฌูุฏ slug ุตุญูุญ
4. ุฅูุดุงุก ุงูุฅุดุนุงุฑ ููุท ุฅุฐุง ูุฌุญุช ุฌููุน ุงููุญูุตุงุช

### ุฌ. **ุงูุชูุธูู ุงูุฏูุฑู:**
1. ูุญุต ุฌููุน ุงูุฅุดุนุงุฑุงุช ูู ุณุงุนุฉ
2. ุงูุชุญูู ูู ุตุญุฉ ุงูููุงูุงุช ุงููุฑุชุจุทุฉ
3. ุญุฐู ุงูุฅุดุนุงุฑุงุช ููููุงูุงุช ุงููุญุฐููุฉ
4. ุฅุญุตุงุฆูุงุช ููุตูุฉ ูููุฑุงูุจุฉ

## ๐งช **ุงุฎุชุจุงุฑ ุงูุญู:**

### 1. ุชูุธูู ููุฑู:
```bash
curl -X POST "http://localhost:3001/api/test-notifications/cleanup"
```

### 2. ูุญุต ุงูุฅุดุนุงุฑุงุช:
```bash
curl -X GET "http://localhost:3001/api/test-notifications?limit=5"
```

### 3. ุชูุธูู ุฏูุฑู (ูุญูู ุจู CRON_SECRET):
```bash
curl -H "Authorization: Bearer $CRON_SECRET" \
     "http://localhost:3001/api/cron/cleanup-notifications"
```

## ๐ **ุงููููุงุช ุงููุญุฏุซุฉ:**
- โ `/app/api/articles/[id]/route.ts` - ุญุฐู ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุญุฐู ุงูููุงู
- โ `/lib/notifications/smart-engine.ts` - ูุญุต ุตุญุฉ ุงูููุงู ูุจู ุงูุฅูุดุงุก  
- โ `/app/api/cron/cleanup-notifications/route.ts` - ุชูุธูู ุฏูุฑู ุฌุฏูุฏ
- โ `/app/api/test-notifications/cleanup/route.ts` - ููุฌูุฏุฉ ูุณุจูุงู ููุญุฏุซุฉ

## ๐ **ุงูุชูุตูุงุช ูููุณุชูุจู:**

1. **ุฅุนุฏุงุฏ Cron Job ุญูููู:**
   ```bash
   # ูู ุณุงุนุฉ
   0 * * * * curl -H "Authorization: Bearer $CRON_SECRET" https://your-domain.com/api/cron/cleanup-notifications
   ```

2. **ูุฑุงูุจุฉ ุงูุฅุญุตุงุฆูุงุช:**
   - ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฐููุฉ ููููุงู
   - ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงูููุณูุฑุฉ ุงูุฃูุซุฑ ุดููุนุงู

3. **ุชุญุณููุงุช ุฅุถุงููุฉ:**
   - ููุฑุณุฉ ุฃูุถู ูุฌุฏูู ุงูุฅุดุนุงุฑุงุช
   - ุถุบุท ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ

---
## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**
**โ ูู ูุนูุฏ ุงููุณุชุฎุฏู ูุชููู ุฅุดุนุงุฑุงุช ููุฃุฎุจุงุฑ ุงููุญุฐููุฉ!**
**โ ุงููุธุงู ููุธู ููุณู ุชููุงุฆูุงู ูู ุณุงุนุฉ**
**โ ุญูุงูุฉ ุดุงููุฉ ูู ุฅูุดุงุก ุฅุดุนุงุฑุงุช ููุณูุฑุฉ**
