# 🛠️ إصلاح نظام القوالب والهيدر

## ✅ التحديثات المنفذة:

### 1️⃣ **ربط قالب الهيدر بالواجهة الأمامية**

#### التحديثات:
- **تحديث مكون Header** (`/components/Header.tsx`):
  - إضافة دالة `fetchActiveHeaderTemplate()` لجلب القالب النشط من API
  - استخدام بيانات القالب للشعار والروابط والألوان
  - دعم الشعار المخصص من القالب
  - دعم روابط التنقل الديناميكية
  - دعم الألوان المخصصة (primary/secondary)

- **إنشاء API Endpoint** (`/api/templates/active-header/route.ts`):
  - يبحث عن القالب بالأولوية التالية:
    1. قالب `is_default = true`
    2. قالب `is_active = true`
    3. أول قالب من نوع header

### 2️⃣ **إصلاح مشكلة رفع الشعار**

#### التحديثات:
- **تحديث HeaderEditor** (`/app/dashboard/templates/components/editors/HeaderEditor.tsx`):
  - إضافة `input[type="file"]` مخفي مع ref
  - إضافة دالة `handleLogoUpload()` للتعامل مع رفع الملفات
  - التحقق من نوع وحجم الملف
  - عرض معاينة للشعار الحالي
  - دعم الصيغ: PNG, JPG, SVG, WEBP
  - الحد الأقصى للحجم: 5MB

- **إنشاء API لرفع الملفات** (`/api/upload/route.ts`):
  - حفظ الملفات في `/public/uploads/logos/`
  - إنشاء أسماء فريدة للملفات
  - إرجاع رابط الملف المرفوع

### 3️⃣ **API لحفظ القوالب** (`/api/templates/[id]/route.ts`):
- دعم تحديث القوالب (PUT)
- التعامل مع `is_default` بشكل صحيح
- تحديث `updated_at` تلقائياً

## 🎯 كيفية الاستخدام:

### لتغيير الشعار:
1. اذهب إلى `/dashboard/templates`
2. اضغط على تعديل القالب النشط
3. اختر تبويب "الشعار"
4. اضغط على "رفع شعار جديد"
5. اختر الصورة المطلوبة
6. احفظ القالب

### لتفعيل قالب:
1. عدّل القالب المطلوب
2. فعّل خيار "قالب افتراضي" أو "قالب نشط"
3. احفظ التغييرات
4. سيظهر التغيير فوراً في الموقع

## 📝 ملاحظات:
- الشعار المرفوع يُحفظ في `/public/uploads/logos/`
- يتم تحديث الهيدر تلقائياً عند حفظ القالب
- يمكن استخدام روابط خارجية للشعار أيضاً
- مجلد uploads محمي من Git

## ⚠️ متطلبات:
- تأكد من وجود صلاحيات الكتابة لمجلد `/public/uploads/`
- أعد تشغيل السيرفر بعد التحديثات 