# نظام النشرات الإخبارية الصوتية - تقرير التطوير

## تاريخ التنفيذ
2025-01-17

## نظرة عامة
تم تطوير نظام موحد وشامل لإدارة النشرات الصوتية في لوحة التحكم، يجمع بين إنشاء النشرات وإدارة الأرشيف في واجهة واحدة احترافية.

## التغييرات المنفذة

### 1. تحديث القائمة الجانبية
- **الملف**: `app/dashboard/layout.tsx`
- **التغيير**: دمج روابط "اختبار الصوت" و"أرشيف النشرات" في رابط واحد "النشرات الإخبارية الصوتية"
- **الرابط الجديد**: `/dashboard/audio-newsletters`

### 2. إنشاء صفحة موحدة للنشرات الصوتية
- **الملف**: `app/dashboard/audio-newsletters/page.tsx`
- **المميزات**:
  - قسم إنشاء النشرة الجديدة
  - قسم أرشيف النشرات
  - معاينة الصوت قبل النشر
  - إدارة كاملة للنشرات

### 3. مسارات API الجديدة
#### الحصول على النشرات
- **المسار**: `/api/audio/newsletters`
- **الوظيفة**: جلب قائمة جميع النشرات

#### نشر نشرة جديدة
- **المسار**: `/api/audio/publish`
- **الوظيفة**: نشر نشرة صوتية جديدة مع خيار التمييز

#### الحصول على النشرة المميزة
- **المسار**: `/api/audio/newsletters/featured`
- **الوظيفة**: جلب النشرة المميزة للعرض في الصفحة الرئيسية

#### تبديل حالة النشر
- **المسار**: `/api/audio/newsletters/[id]/toggle-publish`
- **الوظيفة**: نشر أو إلغاء نشر النشرة

#### حذف النشرة
- **المسار**: `/api/audio/newsletters/[id]`
- **الوظيفة**: حذف نشرة صوتية

### 4. نموذج قاعدة البيانات
```prisma
model AudioNewsletter {
  id              String   @id @default(uuid())
  title           String
  content         String   @db.Text
  audioUrl        String
  duration        Int      // بالثواني
  voice_id        String
  voice_name      String
  language        String   @default("ar")
  category        String?
  is_published    Boolean  @default(false)
  is_featured     Boolean  @default(false)
  play_count      Int      @default(0)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}
```

### 5. تحديث بلوك النشرة الصوتية
- **الملف**: `components/home/PodcastBlock.tsx`
- **التغيير**: تحديث لاستخدام API النشرات الجديد بدلاً من الأرشيف القديم

## المميزات الرئيسية

### قسم إنشاء النشرة
1. **إدخال المحتوى**: حقل نصي كبير لكتابة محتوى النشرة
2. **العنوان الاختياري**: إمكانية إضافة عنوان مخصص
3. **التصنيف**: اختيار تصنيف النشرة (عام، اقتصادي، رياضي، إلخ)
4. **اختيار الصوت**: قائمة بجميع الأصوات المتاحة مع معاينة
5. **اختيار اللغة**: عربي أو إنجليزي
6. **خيار التمييز**: لعرض النشرة في البلوك الأحمر الرئيسي
7. **معاينة قبل النشر**: الاستماع للنشرة قبل نشرها

### قسم الأرشيف
1. **جدول شامل**: عرض جميع النشرات مع معلوماتها
2. **فلترة**: حسب الحالة (منشورة/غير منشورة)
3. **ترتيب**: حسب التاريخ، العنوان، أو الحالة
4. **إجراءات سريعة**:
   - تشغيل مباشر
   - تحميل الملف الصوتي
   - نشر/إلغاء النشر
   - حذف النشرة
5. **عداد الاستماع**: عرض عدد مرات تشغيل كل نشرة
6. **مؤشرات الحالة**: نقطة خضراء للمنشورة، حمراء لغير المنشورة

## التحسينات المستقبلية المقترحة
1. **إحصائيات تفصيلية**: رسوم بيانية لعدد الاستماع عبر الوقت
2. **جدولة النشر**: إمكانية جدولة نشر النشرات في أوقات محددة
3. **نسخ متعددة**: إنشاء نسخ بلغات أو أصوات مختلفة
4. **تكامل مع الواتساب**: إرسال النشرات مباشرة للمشتركين
5. **تصدير التقارير**: تصدير إحصائيات الاستماع كـ PDF أو Excel

## ملاحظات للتنفيذ
- يتطلب تشغيل `npx prisma db push` لإنشاء جدول AudioNewsletter
- يجب التأكد من وجود مفتاح ElevenLabs API في متغيرات البيئة
- النشرات المميزة تظهر تلقائياً في البلوك الأحمر بالصفحة الرئيسية 