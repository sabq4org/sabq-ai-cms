# 🧹 دليل حذف البيانات التجريبية من قاعدة بيانات PlanetScale

## 📋 الملخص التنفيذي

تم إنشاء نظام شامل لحذف البيانات التجريبية والاعتماد الكامل على قاعدة بيانات PlanetScale الإنتاجية.

## ✅ ما تم إنجازه

### 1. **سكريبتات التنظيف**

#### أ) سكريبت TypeScript المتقدم
- **الملف**: `/scripts/clean-test-data.ts`
- **المميزات**:
  - تحليل شامل للبيانات قبل الحذف
  - معاملات آمنة (Transactions)
  - حماية المستخدمين الذين لديهم محتوى حقيقي
  - تقارير مفصلة

#### ب) سكريبت JavaScript البسيط
- **الملف**: `/scripts/clean-test-data-simple.js`
- **المميزات**:
  - سريع وسهل الاستخدام
  - تأكيد من المستخدم قبل الحذف
  - إحصائيات فورية

#### ج) سكريبت SQL المباشر
- **الملف**: `/scripts/clean-test-data.sql`
- **المميزات**:
  - استعلامات SQL مباشرة
  - معلق بشكل افتراضي للأمان
  - سهل التعديل والتخصيص

### 2. **نظام منع البيانات التجريبية**

#### Content Validator
- **الملف**: `/lib/validators/content-validator.ts`
- **المميزات**:
  - منع الكلمات المحظورة (test, تجربة، dummy)
  - التحقق من طول المحتوى (200 حرف كحد أدنى)
  - التحقق من البريد الإلكتروني
  - رسائل خطأ واضحة بالعربية

## 🚀 كيفية الاستخدام

### الطريقة السريعة (موصى بها):

```bash
# 1. التحقق من البيانات التجريبية
node scripts/clean-test-data-simple.js

# 2. الموافقة على الحذف بكتابة "yes"
```

### الطريقة المتقدمة:

```bash
# تثبيت ts-node إذا لم يكن موجوداً
npm install -g ts-node

# تشغيل السكريبت المتقدم
ts-node scripts/clean-test-data.ts
```

### الطريقة اليدوية (SQL):

1. افتح PlanetScale Console
2. انسخ الاستعلامات من `/scripts/clean-test-data.sql`
3. قم بإزالة التعليقات من أوامر DELETE
4. نفذ الاستعلامات

## 📊 البيانات التي سيتم حذفها

### المقالات التجريبية:
- المقالات التي تحتوي على "السلام عليكم"
- المقالات التي تحتوي على "test" أو "تجربة"
- المقالات القصيرة جداً (أقل من 200 حرف)

### المستخدمين التجريبيين:
- المستخدمين بأسماء تحتوي على "test" أو "dummy"
- البريد الإلكتروني @test.com أو @example.com
- **ملاحظة**: لن يتم حذف المستخدمين الذين لديهم مقالات حقيقية

## 🛡️ آليات الحماية المستقبلية

### 1. **التحقق عند الإدخال**
```typescript
import { validateArticle } from '@/lib/validators/content-validator';

// في API إنشاء المقال
const validation = validateArticle({
  title: req.body.title,
  content: req.body.content,
  excerpt: req.body.excerpt
});

if (!validation.isValid) {
  return res.status(400).json({
    error: getValidationErrorMessage(validation.errors)
  });
}
```

### 2. **إعدادات البيئة**
```env
# في .env.production
NODE_ENV=production
ALLOW_TEST_DATA=false
```

### 3. **مراجعة دورية**
- جدولة تشغيل سكريبت التنظيف شهرياً
- مراقبة المحتوى الجديد
- تقارير أسبوعية

## ⚠️ تحذيرات مهمة

1. **احفظ نسخة احتياطية** قبل تنفيذ أي عملية حذف
2. **تحقق من الاتصال** بقاعدة البيانات الصحيحة
3. **راجع البيانات** التي سيتم حذفها قبل التأكيد
4. **لا تنفذ في أوقات الذروة**

## 📈 النتائج المتوقعة

### قبل التنظيف:
- 5 مقالات (4 تجريبية + 1 حقيقي)
- محتوى مختلط وغير احترافي

### بعد التنظيف:
- مقالات حقيقية فقط
- محتوى احترافي
- قاعدة بيانات نظيفة

## 🔄 الخطوات التالية

1. **إضافة محتوى حقيقي**:
   - 10-15 مقال احترافي
   - صور مميزة لكل مقال
   - محتوى غني (300+ كلمة)

2. **تفعيل الحماية**:
   - استخدام Content Validator في جميع النماذج
   - مراجعة المحتوى قبل النشر
   - صلاحيات محددة للكتابة

3. **المراقبة المستمرة**:
   - تقارير أسبوعية
   - تنبيهات للمحتوى المشبوه
   - مراجعة دورية

## 📞 الدعم

في حالة وجود أي مشاكل:
1. راجع السجلات (logs)
2. تحقق من اتصال قاعدة البيانات
3. تأكد من الصلاحيات

---

*آخر تحديث: 15 يناير 2025*
*تم الإعداد بواسطة: نظام سبق الذكي* 