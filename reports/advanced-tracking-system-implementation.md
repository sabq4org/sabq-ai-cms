# نظام التتبع والتحليل الذكي المتقدم - تقرير التنفيذ

## 📋 نظرة عامة

تم بناء نظام تتبع وتحليل سلوكي متطور وقابل للتطوير لموقع سبق AI CMS، يوفر رؤى عميقة حول سلوك القراء ويقدم توصيات ذكية مخصصة.

## 🏗️ البنية التحتية

### 1. جداول قاعدة البيانات الجديدة (Prisma Schema)

```prisma
// جداول رئيسية جديدة:
- Session: لتتبع جلسات المستخدمين
- Impression: لتسجيل انطباعات القراءة
- Recommendation: لحفظ التوصيات المقترحة
- UserBehaviorPattern: لتخزين أنماط السلوك
- ReadingHistory: لسجل القراءة التفصيلي
```

### 2. واجهات برمجة التطبيقات (APIs)

#### أ) API الجلسات (`/api/sessions`)
- **POST**: بدء جلسة جديدة مع بصمة الجهاز
- **PUT**: إنهاء الجلسة وحساب المدة
- **GET**: جلب معلومات الجلسة أو جلسات المستخدم

#### ب) API الانطباعات (`/api/impressions`)
- **POST**: بدء تتبع قراءة مقال
- **PUT**: تحديث معلومات القراءة (نسبة التمرير، الوقت النشط)
- **GET**: جلب إحصائيات الانطباعات

#### ج) API التوصيات (`/api/recommendations`)
- **GET**: جلب توصيات مخصصة بناءً على:
  - اهتمامات المستخدم
  - سجل القراءة
  - أنماط السلوك
  - المحتوى الرائج
- **POST**: تسجيل نقرة على توصية

#### د) API التحليلات السلوكية (`/api/analytics/behavior`)
- تحليل شامل لسلوك المستخدم
- أنماط القراءة حسب الوقت واليوم
- تفضيلات الفئات
- توصيات لتحسين التجربة

## 🎯 المكونات الأمامية

### 1. Dashboard Footer Component
مكون ذكي يعرض في أسفل لوحة التحكم:
- **تبويب الإحصائيات**: ملخص القراءة، الوقت المفضل، الفئات المفضلة
- **تبويب المقترحات**: مقالات مخصصة مع أسباب الاقتراح
- **تبويب أنماط القراءة**: رسوم بيانية للنشاط الأسبوعي وسرعة القراءة

### 2. Behavior Tracker Library
مكتبة JavaScript متطورة للتتبع في الواجهة الأمامية:
```javascript
// مميزات أساسية:
- تتبع الوقت النشط الفعلي (Active Time Tracking)
- قياس نسبة التمرير (Scroll Depth)
- رصد عدم النشاط (Inactivity Detection)
- تتبع تغيير التبويبات (Tab Visibility)
- حماية البيانات عند مغادرة الصفحة
```

### 3. React Hooks للتتبع
```typescript
// useBehaviorTracking: Hook عام للتتبع
// useArticleTracking: Hook مخصص لصفحة المقال
// useArticlesTracking: Hook لتتبع مجموعة مقالات
```

## 🔧 كيفية الاستخدام

### في صفحة المقال:
```typescript
import { useArticleTracking } from '@/hooks/useBehaviorTracking';

function ArticlePage({ article }) {
  const tracking = useArticleTracking(article.id);
  
  return (
    <article>
      {/* محتوى المقال */}
      <button onClick={() => tracking.onLike(true)}>
        إعجاب
      </button>
    </article>
  );
}
```

### في الصفحة الرئيسية:
```typescript
import { useArticlesTracking } from '@/hooks/useBehaviorTracking';
import { useInView } from 'react-intersection-observer';

function ArticleCard({ article }) {
  const tracking = useArticlesTracking();
  const { ref, inView } = useInView({ threshold: 0.5 });
  
  useEffect(() => {
    if (inView) {
      tracking.startTrackingArticle(article.id);
    } else {
      tracking.stopTrackingArticle(article.id);
    }
  }, [inView]);
  
  return <div ref={ref}>...</div>;
}
```

### إضافة Dashboard Footer:
```typescript
import DashboardFooter from '@/components/dashboard/DashboardFooter';

function DashboardLayout({ children }) {
  return (
    <div>
      {children}
      <DashboardFooter />
    </div>
  );
}
```

## 📊 البيانات المُجمعة

### معلومات الجلسة:
- بصمة الجهاز (Device Fingerprint)
- معلومات المتصفح والشاشة
- مدة الجلسة
- عنوان IP (مجهول)

### معلومات القراءة:
- وقت بدء وانتهاء القراءة
- الوقت النشط الفعلي
- نسبة التمرير
- معدل إكمال القراءة

### التفاعلات:
- الإعجابات والحفظ
- المشاركات (مع المنصة)
- التعليقات
- النقرات على التوصيات

## 🎨 خوارزمية التوصيات

### 1. حساب النقاط (Scoring):
```javascript
نقاط البداية: 50
+ مطابقة الاهتمامات: +20 نقطة × معامل الاهتمام
+ شعبية المقال: +10-20 نقطة
+ حداثة المقال: +10-20 نقطة
× معامل تفضيل الفئة
= النقاط النهائية (0-100)
```

### 2. مصادر التوصيات:
- **60%** من الفئات المفضلة
- **30%** مقالات مشابهة لآخر قراءة
- **10%** محتوى رائج

## 🔐 الخصوصية والأمان

- لا يتم تتبع المستخدمين غير المسجلين بشكل شخصي
- استخدام بصمة الجهاز بدلاً من الكوكيز
- تشفير البيانات الحساسة
- حذف البيانات القديمة تلقائياً

## 📈 الفوائد المتوقعة

1. **للمستخدمين**:
   - توصيات دقيقة ومخصصة
   - فهم أفضل لعادات القراءة
   - تحسين تجربة القراءة

2. **للمحررين**:
   - رؤى عميقة حول أداء المحتوى
   - فهم اهتمامات القراء
   - تحسين استراتيجية المحتوى

3. **للموقع**:
   - زيادة معدل الاحتفاظ بالمستخدمين
   - تحسين معدل التفاعل
   - بيانات قيمة لاتخاذ القرارات

## 🚀 الخطوات التالية

1. **تحسينات مقترحة**:
   - إضافة Machine Learning للتوصيات
   - تتبع المشاعر (Sentiment Analysis)
   - A/B Testing للتوصيات

2. **تكاملات إضافية**:
   - ربط مع Google Analytics
   - تصدير التقارير
   - لوحة تحكم للمحررين

3. **أداء وتحسين**:
   - استخدام Web Workers للتتبع
   - تحسين دقة قياس الوقت النشط
   - Batch API calls لتقليل الطلبات

## 🛠️ الصيانة والمراقبة

- مراقبة أداء APIs
- تنظيف البيانات القديمة دورياً
- مراجعة دقة التوصيات
- تحديث الخوارزميات بناءً على الملاحظات

---

تم التنفيذ بواسطة: نظام سبق AI CMS
التاريخ: ٢٩-٦-١٤٤٦ هـ
الإصدار: 1.0.0 