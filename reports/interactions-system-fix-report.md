# ุชูุฑูุฑ ุฅุตูุงุญ ูุธุงู ุงูุชูุงุนูุงุช - ุญูุธ ุงูุฅุนุฌุงุจุงุช ูุงููุญููุธุงุช

## ๐ ุงูุชุงุฑูุฎ: ููุงูุฑ 2025

## ๐ด ุงููุดููุฉ ุงููุฑุตูุฏุฉ

ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ "ุฃุนุฌุจูู" ุฃู "ุญูุธ" ูู ุงูููุงูุงุช:
- โ ูุชู ุชูุนูู ุงูุฃููููุฉ ุจุตุฑูุงู
- โ ูุง ูุชู ุญูุธ ุงูุชูุงุนู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูุฅุญุตุงุฆูุงุช ูู ุงูุจุฑููุงูู ูุง ุชุนูุณ ุงูุชูุงุนูุงุช ุงูุญููููุฉ
- โ ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉุ ุชุฎุชูู ุงูุชูุงุนูุงุช

## ๐ ุชุญููู ุงููุดููุฉ

### 1. **API Endpoint ุงููุจุณุท**
- ุงูููู: `/api/interactions/route.ts`
- ูุงู ูุญุชูู ุนูู ููุฏ ูุจุณุท ูุฑุฌุน ุฑุณุงุฆู ูุฌุงุญ ููููุฉ ุฏูู ุญูุธ ูุนูู

### 2. **ุงุณุชุฎุฏุงู endpoints ุบูุฑ ููุฌูุฏุฉ**
- ูููู `ArticleInteractionBar` ูุงู ูุณุชุฎุฏู:
  - `/api/articles/${articleId}/like` (ุบูุฑ ููุฌูุฏ)
  - `/api/bookmarks` (ููุญูุธ)

### 3. **ุนุฏู ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู**
- ุงูุณูุงุญ ุจุงูุชูุงุนู ุฏูู ุงูุชุญูู ูู ูุฌูุฏ user_id ุตุงูุญ

## โ ุงูุญููู ุงููููุฐุฉ

### 1. **ุฅุนุงุฏุฉ ูุชุงุจุฉ `/api/interactions/route.ts`**

```typescript
// ูุนุงูุฌุฉ POST ููุชูุงุนูุงุช
export async function POST(request: NextRequest) {
  // ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุทููุจุฉ
  const { userId, articleId, type, action } = body;
  
  // ุญูุธ/ุญุฐู ุงูุชูุงุนู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  if (action === 'remove') {
    await prisma.interactions.deleteMany({...});
  } else {
    await prisma.interactions.upsert({...});
  }
  
  // ุชุญุฏูุซ ุนุฏุงุฏุงุช ุงูููุงู
  await prisma.articles.update({
    data: { [field]: { increment/decrement: 1 } }
  });
  
  // ููุญ ููุงุท ุงูููุงุก
  await prisma.loyalty_points.create({...});
}
```

### 2. **ุฅูุดุงุก `/api/user/activity-summary/route.ts`**

API ุฌุฏูุฏ ูุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุดุงุท ุงูุญููููุฉ:
```typescript
const [likesCount, savesCount, sharesCount, viewsCount] = await Promise.all([
  prisma.interactions.count({ where: { user_id, type: 'like' } }),
  prisma.interactions.count({ where: { user_id, type: 'save' } }),
  // ...
]);
```

### 3. **ุชุญุฏูุซ `ArticleInteractionBar.tsx`**

```typescript
// ุงุณุชุฎุฏุงู API ุงูุฌุฏูุฏ
const response = await fetch('/api/interactions', {
  method: 'POST',
  body: JSON.stringify({ 
    userId,
    articleId,
    type: 'like', // ุฃู 'save'
    action: newLiked ? 'add' : 'remove'
  })
});

// ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
if (!userId || userId === 'anonymous') {
  toast.error('ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ููุฅุนุฌุงุจ');
  return;
}
```

## ๐ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ

### ุฌุฏูู `interactions`
```prisma
model interactions {
  id         String  @id
  user_id    String
  article_id String
  type       interactions_type // like, save, share, comment, view
  created_at DateTime @default(now())
  
  @@unique([user_id, article_id, type])
}
```

### ุฌุฏูู `loyalty_points`
```prisma
model loyalty_points {
  id             String   @id
  user_id        String
  points         Int
  action         String
  reference_id   String?
  reference_type String?
  metadata       Json?
  created_at     DateTime @default(now())
}
```

## ๐ฏ ููุงุท ุงูููุงุก ุงููุทุจูุฉ

| ุงูุชูุงุนู | ุงูููุงุท |
|---------|--------|
| ุฅุนุฌุงุจ (like) | 10 ููุงุท |
| ุญูุธ (save) | 15 ููุงุท |
| ูุดุงุฑูุฉ (share) | 20 ููุงุท |
| ุชุนููู (comment) | 25 ููุงุท |
| ูุดุงูุฏุฉ (view) | 1 ููุทุฉ |

## ๐ง ุงูุชุญุณููุงุช ุงูุฅุถุงููุฉ

### 1. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**
- ุฅุฑุฌุงุน ุญุงูุฉ ุงูุชูุงุนู ุงูุณุงุจูุฉ ุนูุฏ ูุดู ุงูุทูุจ
- ุนุฑุถ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู

### 2. **ุงูุฃุฏุงุก**
- ุงุณุชุฎุฏุงู `upsert` ูุชุฌูุจ ุงูุชูุฑุงุฑ
- ุชุญุฏูุซ ุงูุนุฏุงุฏุงุช ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงุณุชุฎุฏุงู Promise.all ููุทูุจุงุช ุงููุชูุงุฒูุฉ

### 3. **ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**
- ุนุฑุถ ุฅุดุนุงุฑุงุช ุนูุฏ ุงููุฌุงุญ/ุงููุดู
- ุชุญุฏูุซ ุงููุงุฌูุฉ ููุฑูุงู (optimistic updates)
- ุญูุธ ุญุงูุฉ ุงูุชูุงุนู ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุญููู

## ๐ API Endpoints ุงููุชููุฑุฉ

### 1. **POST /api/interactions**
- ุฅุถุงูุฉ ุฃู ุฅุฒุงูุฉ ุชูุงุนู
- ุงููุนุงููุงุช: `userId`, `articleId`, `type`, `action`

### 2. **GET /api/interactions**
- ุฌูุจ ุญุงูุฉ ุงูุชูุงุนูุงุช ูููุงู ูุนูู
- ุงููุนุงููุงุช: `userId`, `articleId`

### 3. **GET /api/user/activity-summary**
- ุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุดุงุท ุงููุงููุฉ
- ุงููุนุงููุงุช: `userId`

### 4. **GET /api/user/stats**
- ุฅุญุตุงุฆูุงุช ููุตูุฉ ููุจุฑููุงูู
- ุงููุนุงููุงุช: `userId`

## โ ุงููุชุงุฆุฌ ุงููุญููุฉ

1. **ุญูุธ ุงูุชูุงุนูุงุช ุจูุฌุงุญ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. **ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุญููููุฉ** ูู ุงูุจุฑููุงูู
3. **ููุญ ููุงุท ุงูููุงุก** ุนูุฏ ุงูุชูุงุนู
4. **ุงุณุชูุฑุงุฑ ุงูุชูุงุนูุงุช** ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุญููู
5. **ุชุญุฏูุซ ุงูุนุฏุงุฏุงุช** ูู ุงูููุช ุงููุนูู

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุตู ุจูุง

1. **ุฅุถุงูุฉ cache** ููุฅุญุตุงุฆูุงุช ูุชุญุณูู ุงูุฃุฏุงุก
2. **ุฅูุดุงุก webhook** ูุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู ุงูููุช ุงููุนูู
3. **ุฅุถุงูุฉ analytics** ูุชุชุจุน ุฃููุงุท ุงูุชูุงุนู
4. **ุชุทููุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช** ุนูุฏ ุงูุชูุงุนูุงุช ุงูุฌุฏูุฏุฉ

## ๐ ูุซุงู ุนูู ุงูุจูุงูุงุช ุงููุญููุธุฉ

```json
// ุชูุงุนู ุฅุนุฌุงุจ
{
  "id": "interaction-1736850123456-abc123",
  "user_id": "0f107dd1-bfb7-4fac-b664-6587e6fc9a1e",
  "article_id": "article-123",
  "type": "like",
  "created_at": "2025-01-14T10:30:00Z"
}

// ููุงุท ููุงุก
{
  "id": "loyalty-1736850123456-xyz789",
  "user_id": "0f107dd1-bfb7-4fac-b664-6587e6fc9a1e",
  "points": 10,
  "action": "like_article",
  "reference_id": "article-123",
  "reference_type": "article",
  "metadata": {
    "interaction_id": "interaction-1736850123456-abc123",
    "timestamp": "2025-01-14T10:30:00Z"
  }
}
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. ูุฌุจ ุนูู ุงููุณุชุฎุฏู ุชุณุฌูู ุงูุฏุฎูู ููุชูุงุนู
2. ุงูุชูุงุนูุงุช ูุญููุฉ ูู ุงูุชูุฑุงุฑ ุจู unique constraint
3. ุงูุนุฏุงุฏุงุช ุชูุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุงูุชูุงุนู
4. ุงูููุงุท ุชูููุญ ูุฑุฉ ูุงุญุฏุฉ ููุท ููู ุชูุงุนู

---

ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุชูุฑูุฑ ูุชูุซูู ุญู ูุดููุฉ ุญุฑุฌุฉ ูู ูุธุงู ุงูุชูุงุนูุงุช ูุถูุงู ุนููู ุจุดูู ุตุญูุญ ูุฏุงุฆู. 