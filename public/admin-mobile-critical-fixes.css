/**
 * إصلاحات حرجة لمشكلة عرض صفحة الأخبار على الموبايل
 * Critical Mobile News Page Fixes
 */

/* إعادة تعيين شاملة وقوية */
@media screen and (max-width: 768px) {
  /* إصلاح الـ viewport والعرض */
  html, body {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow-x: hidden !important;
    position: relative !important;
  }

  /* إصلاح الحاوي الرئيسي */
  #__next,
  #__next > div,
  .admin-mobile-container,
  .mobile-news-page,
  main,
  .main-content,
  [class*="main"] {
    width: 100% !important;
    max-width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    position: relative !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    overflow-x: hidden !important;
  }

  /* إخفاء القائمة الجانبية نهائياً */
  .sidebar,
  .mobile-sidebar,
  .admin-sidebar,
  nav[class*="sidebar"],
  [class*="sidebar"]:not(.no-sidebar),
  .side-nav,
  [class*="side-nav"],
  .navigation-sidebar,
  aside {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
    visibility: hidden !important;
    position: absolute !important;
    left: -9999px !important;
  }

  /* إصلاح المحتوى الرئيسي ليأخذ العرض الكامل */
  .news-page-container,
  .page-container,
  .content-container,
  main > div:first-child {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    display: block !important;
    position: relative !important;
  }

  /* إصلاح المحتوى الداخلي */
  .news-page-container > div,
  .page-content,
  .inner-content {
    width: 100% !important;
    padding: 16px !important;
    margin: 0 !important;
    box-sizing: border-box !important;
  }

  /* إصلاح الهيدر */
  .admin-header,
  .mobile-header,
  header {
    width: 100% !important;
    position: sticky !important;
    top: 0 !important;
    z-index: 1000 !important;
    background: hsl(var(--bg)) !important;
    padding: 12px 16px !important;
    box-sizing: border-box !important;
  }

  /* إصلاح شريط البحث والفلاتر */
  .search-filter-bar {
    width: 100% !important;
    padding: 12px 16px !important;
    position: sticky !important;
    top: 60px !important; /* بعد الهيدر */
    background: hsl(var(--bg)) !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }

  /* إصلاح قائمة الأخبار */
  .news-list-container,
  .news-list-mobile {
    width: 100% !important;
    padding: 16px !important;
    margin: 0 !important;
    box-sizing: border-box !important;
  }

  /* إصلاح بطاقات الأخبار */
  .news-card-mobile,
  .news-card {
    width: 100% !important;
    margin: 0 0 12px 0 !important;
    padding: 12px !important;
    box-sizing: border-box !important;
    display: block !important;
    position: relative !important;
  }

  /* إصلاح الجداول - تحويلها لبطاقات */
  table {
    display: block !important;
    width: 100% !important;
    overflow: visible !important;
  }

  table thead {
    display: none !important;
  }

  table tbody {
    display: block !important;
    width: 100% !important;
  }

  table tr {
    display: block !important;
    width: 100% !important;
    margin-bottom: 16px !important;
    padding: 16px !important;
    background: hsl(var(--bg-card)) !important;
    border: 1px solid hsl(var(--line)) !important;
    border-radius: 8px !important;
    box-sizing: border-box !important;
  }

  table td {
    display: block !important;
    width: 100% !important;
    padding: 8px 0 !important;
    text-align: right !important;
    border: none !important;
    box-sizing: border-box !important;
  }

  /* إصلاح حقول الإدخال */
  input[type="text"],
  input[type="search"],
  input[type="email"],
  input[type="tel"],
  input[type="number"],
  input[type="password"],
  textarea,
  select {
    width: 100% !important;
    font-size: 16px !important; /* منع التكبير على iOS */
    padding: 12px !important;
    box-sizing: border-box !important;
  }

  /* إصلاح الأزرار */
  button,
  .btn,
  [class*="button"] {
    min-height: 44px !important;
    min-width: 44px !important;
    padding: 12px 16px !important;
    font-size: 14px !important;
    box-sizing: border-box !important;
  }

  /* إصلاح البطاقات الإحصائية */
  .stats-grid,
  .stats-container {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
    width: 100% !important;
    padding: 0 !important;
  }

  .stat-card,
  .card {
    width: 100% !important;
    margin: 0 !important;
    box-sizing: border-box !important;
  }

  /* إصلاح الـ modals و dropdowns */
  .modal,
  .dropdown-menu,
  [role="dialog"] {
    max-width: calc(100vw - 32px) !important;
    margin: 16px !important;
  }

  /* إصلاح الـ overflow */
  * {
    max-width: 100vw !important;
  }

  /* إزالة أي transforms أو absolute positioning غير ضروري */
  .page-wrapper,
  .content-wrapper {
    transform: none !important;
    position: relative !important;
    left: 0 !important;
    right: 0 !important;
  }

  /* إصلاح z-index للعناصر المهمة */
  .mobile-header,
  .admin-header {
    z-index: 1000 !important;
  }

  .search-filter-bar {
    z-index: 900 !important;
  }

  .bottom-navigation {
    z-index: 999 !important;
  }

  .fab {
    z-index: 998 !important;
  }

  /* إصلاح الـ grid system */
  .grid,
  [class*="grid"] {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* إصلاح الـ flex containers */
  .flex-row,
  [class*="flex-row"] {
    flex-direction: column !important;
  }

  /* إخفاء العناصر غير الضرورية على الموبايل */
  .desktop-only,
  .hide-mobile,
  [class*="desktop-only"] {
    display: none !important;
  }

  /* إصلاح الصور */
  img {
    max-width: 100% !important;
    height: auto !important;
  }

  /* إصلاح الـ typography */
  h1 { font-size: 24px !important; }
  h2 { font-size: 20px !important; }
  h3 { font-size: 18px !important; }
  h4 { font-size: 16px !important; }
  p, span { font-size: 14px !important; }

  /* إصلاح الـ padding و margin */
  .container,
  [class*="container"] {
    padding: 0 16px !important;
    margin: 0 !important;
  }

  /* تحسين الـ touch targets */
  a, button, input, select, textarea, [role="button"] {
    min-height: 44px !important;
  }

  /* إصلاح عرض الصور المصغرة */
  .news-thumbnail {
    width: 80px !important;
    height: 80px !important;
    flex-shrink: 0 !important;
  }

  /* إصلاح محتوى البطاقات */
  .news-content {
    flex: 1 !important;
    min-width: 0 !important;
  }

  /* إصلاح العناوين في البطاقات */
  .news-title {
    font-size: 16px !important;
    line-height: 1.4 !important;
    margin: 0 0 8px 0 !important;
  }

  /* التأكد من عدم وجود horizontal scroll */
  .news-card-mobile,
  .news-card-content {
    overflow: hidden !important;
  }
}

/* للشاشات الصغيرة جداً */
@media screen and (max-width: 480px) {
  /* تقليل الـ padding */
  .news-page-container > div,
  .page-content {
    padding: 12px !important;
  }

  /* تقليل حجم الصور المصغرة */
  .news-thumbnail {
    width: 60px !important;
    height: 60px !important;
  }

  /* تقليل حجم الخطوط */
  .news-title {
    font-size: 14px !important;
  }

  h1 { font-size: 20px !important; }
  h2 { font-size: 18px !important; }
  h3 { font-size: 16px !important; }
}

/* إصلاحات خاصة بـ Safari و iOS */
@supports (-webkit-touch-callout: none) {
  /* iOS specific fixes */
  .mobile-news-page,
  .admin-mobile-container {
    min-height: -webkit-fill-available !important;
  }

  /* منع التكبير التلقائي */
  input, select, textarea {
    font-size: 16px !important;
  }
}

/* تحسينات الأداء */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
  }
}

/* إصلاح نهائي قوي */
@media screen and (max-width: 768px) {
  body > div:first-child {
    display: flex !important;
    flex-direction: column !important;
    min-height: 100vh !important;
  }

  /* فرض العرض الكامل على جميع العناصر */
  body * {
    max-width: 100vw !important;
  }

  /* إزالة أي margin أو padding خارجي */
  body > * {
    margin: 0 !important;
  }
}
