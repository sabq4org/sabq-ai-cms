<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Ù…ØµØ­Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª - Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; }
        .notification-item { 
            transition: all 0.3s ease; 
            border-right: 4px solid #e5e7eb;
        }
        .notification-item:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 16px rgba(0,0,0,0.15); 
        }
        .notification-unread { border-right-color: #10b981; background: rgba(16, 185, 129, 0.05); }
        .notification-read { border-right-color: #6b7280; background: rgba(107, 114, 128, 0.05); }
        .api-status { 
            display: inline-block; 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 12px; 
            font-weight: bold; 
            transition: all 0.3s ease;
        }
        .status-success { background: linear-gradient(45deg, #10b981, #059669); color: white; }
        .status-error { background: linear-gradient(45deg, #ef4444, #dc2626); color: white; }
        .status-loading { background: linear-gradient(45deg, #f59e0b, #d97706); color: white; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .card { 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.2s ease;
        }
        .card:hover { transform: translateY(-2px); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .auth-info { background: linear-gradient(45deg, #4f46e5, #7c3aed); }
        .debug-success { color: #10b981; }
        .debug-error { color: #ef4444; }
        .debug-warning { color: #f59e0b; }
        .debug-info { color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Fixed Header -->
    <header class="gradient-bg text-white shadow-lg fixed top-0 w-full z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <i class="fas fa-tools text-2xl animate-pulse"></i>
                    <div>
                        <h1 class="text-xl font-bold">ğŸ”§ Ù…ØµØ­Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
                        <p class="text-blue-100 text-sm">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… - ØªØ´Ø®ÙŠØµ ÙˆØ¥ØµÙ„Ø§Ø­ Ù…Ø¨Ø§Ø´Ø±</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <span id="current-time" class="text-xs bg-white bg-opacity-20 px-3 py-1 rounded-full"></span>
                    <div class="auth-info px-3 py-1 rounded-lg text-sm">
                        <i class="fas fa-user-shield"></i>
                        <span class="mr-2">Ù…ØµØ§Ø¯Ù‚</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8 mt-20">
        <!-- Quick Status Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white rounded-lg p-4 text-center shadow-md">
                <div class="text-2xl mb-2">ğŸ—„ï¸</div>
                <div id="db-status" class="text-sm font-semibold text-gray-600">ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow-md">
                <div class="text-2xl mb-2">ğŸ‘¥</div>
                <div id="users-count" class="text-sm font-semibold text-gray-600">ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow-md">
                <div class="text-2xl mb-2">ğŸ””</div>
                <div id="notifications-total" class="text-sm font-semibold text-gray-600">ÙØ­Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...</div>
            </div>
        </div>

        <!-- API Status Cards -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Test API -->
            <div class="card bg-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">
                        <i class="fas fa-flask text-orange-500 mr-2"></i>
                        API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
                    </h3>
                    <span id="test-api-status" class="api-status status-loading">
                        <i class="fas fa-spinner loading mr-1"></i>
                        ÙØ­Øµ
                    </span>
                </div>
                <p class="text-sm text-gray-600 mb-4">/api/test-notifications</p>
                <div id="test-api-details" class="space-y-2 text-sm mb-4">
                    <div class="text-gray-500">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</div>
                </div>
                <button onclick="testTestAPI()" class="w-full bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                    <i class="fas fa-play mr-2"></i>Ø§Ø®ØªØ¨Ø§Ø±
                </button>
            </div>

            <!-- Universal API -->
            <div class="card bg-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">
                        <i class="fas fa-globe text-green-500 mr-2"></i>
                        API Ø§Ù„Ø´Ø§Ù…Ù„
                    </h3>
                    <span id="universal-api-status" class="api-status status-loading">
                        <i class="fas fa-spinner loading mr-1"></i>
                        ÙØ­Øµ
                    </span>
                </div>
                <p class="text-sm text-gray-600 mb-4">/api/notifications-universal</p>
                <div id="universal-api-details" class="space-y-2 text-sm mb-4">
                    <div class="text-gray-500">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</div>
                </div>
                <button onclick="testUniversalAPI()" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                    <i class="fas fa-play mr-2"></i>Ø§Ø®ØªØ¨Ø§Ø±
                </button>
            </div>

            <!-- Real API -->
            <div class="card bg-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">
                        <i class="fas fa-server text-blue-500 mr-2"></i>
                        API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                    </h3>
                    <span id="real-api-status" class="api-status status-loading">
                        <i class="fas fa-spinner loading mr-1"></i>
                        ÙØ­Øµ
                    </span>
                </div>
                <p class="text-sm text-gray-600 mb-4">/api/notifications</p>
                <div id="real-api-details" class="space-y-2 text-sm mb-4">
                    <div class="text-gray-500">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</div>
                </div>
                <button onclick="testRealAPI()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    <i class="fas fa-play mr-2"></i>Ø§Ø®ØªØ¨Ø§Ø±
                </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card bg-white rounded-xl p-6 shadow-lg mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">
                <i class="fas fa-bolt text-yellow-500 mr-2"></i>
                Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="checkDatabase()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm">
                    <i class="fas fa-database mr-1"></i>
                    ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="checkUsers()" class="bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 transition-colors text-sm">
                    <i class="fas fa-users mr-1"></i>
                    ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                <button onclick="createTestNotification()" class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors text-sm">
                    <i class="fas fa-plus mr-1"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ ØªØ¬Ø±ÙŠØ¨ÙŠ
                </button>
                <button onclick="cleanupBrokenNotifications()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">
                    <i class="fas fa-broom mr-1"></i>
                    ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø©
                </button>
                <button onclick="refreshAll()" class="bg-emerald-500 text-white px-4 py-2 rounded-lg hover:bg-emerald-600 transition-colors text-sm">
                    <i class="fas fa-sync mr-1"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„
                </button>
            </div>
        </div>

        <!-- Current Working Notifications -->
        <div class="card bg-white rounded-xl p-6 shadow-lg mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">
                    <i class="fas fa-bell text-red-500 mr-2"></i>
                    Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    <span id="notifications-count" class="bg-red-500 text-white text-xs px-2 py-1 rounded-full mr-2">0</span>
                </h3>
                <button onclick="loadNotifications()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                    <i class="fas fa-reload mr-2"></i>
                    ØªØ­Ø¯ÙŠØ«
                </button>
            </div>
            
            <div class="mb-4 flex flex-wrap gap-2">
                <select id="api-selector" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                    <option value="test">API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ (ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹)</option>
                    <option value="universal">API Ø§Ù„Ø´Ø§Ù…Ù„ (Ø°ÙƒÙŠ)</option>
                    <option value="real">API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (ÙŠØ­ØªØ§Ø¬ Ù…ØµØ§Ø¯Ù‚Ø©)</option>
                </select>
                <select id="limit-selector" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                    <option value="5">5 Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</option>
                    <option value="10" selected>10 Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</option>
                    <option value="20">20 Ø¥Ø´Ø¹Ø§Ø±</option>
                </select>
            </div>

            <div id="notifications-container" class="space-y-4">
                <div class="text-center text-gray-500 py-8">
                    <i class="fas fa-bell-slash text-4xl text-gray-300 mb-4"></i>
                    <p>Ø§Ø¶ØºØ· "ØªØ­Ø¯ÙŠØ«" Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
                </div>
            </div>
        </div>

        <!-- Debug Console -->
        <div class="card bg-gray-900 rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white">
                    <i class="fas fa-terminal text-green-400 mr-2"></i>
                    ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
                </h3>
                <div class="flex space-x-2 space-x-reverse">
                    <button onclick="clearDebugLog()" class="bg-gray-700 text-white px-3 py-1 rounded text-sm hover:bg-gray-600">
                        <i class="fas fa-trash mr-1"></i>Ù…Ø³Ø­
                    </button>
                    <button onclick="exportLogs()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-500">
                        <i class="fas fa-download mr-1"></i>ØªØµØ¯ÙŠØ±
                    </button>
                </div>
            </div>
            <div id="debug-log" class="bg-black rounded-lg p-4 text-green-400 font-mono text-sm max-h-64 overflow-y-auto">
                <div class="debug-info">[INFO] Ù…ØµØ­Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø§Ù‡Ø²...</div>
            </div>
        </div>
    </div>

    <script>
        let debugLog = [];
        let systemStats = {
            database: 'unknown',
            users: 0,
            notifications: 0,
            apis: {}
        };
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleString('ar-SA');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
        function addToDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = { message, type, timestamp };
            debugLog.push(logEntry);
            
            if (debugLog.length > 100) {
                debugLog = debugLog.slice(-100);
            }
            
            const logElement = document.getElementById('debug-log');
            const div = document.createElement('div');
            div.className = `debug-${type}`;
            div.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
            
            logElement.appendChild(div);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearDebugLog() {
            debugLog = [];
            document.getElementById('debug-log').innerHTML = '<div class="debug-info">[INFO] ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„...</div>';
        }

        // ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function checkDatabase() {
            addToDebugLog('ÙØ­Øµ Ø­Ø§Ù„Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            const statusElement = document.getElementById('db-status');
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ÙØ­Øµ
                const response = await fetch('/api/test-notifications');
                const data = await response.json();
                
                if (data.success) {
                    statusElement.innerHTML = '<span class="text-green-600">âœ… Ù…ØªØµÙ„Ø©</span>';
                    systemStats.database = 'connected';
                    addToDebugLog('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØµÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                statusElement.innerHTML = '<span class="text-red-600">âŒ Ù…Ù†Ù‚Ø·Ø¹Ø©</span>';
                systemStats.database = 'disconnected';
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`, 'error');
            }
        }

        // ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function checkUsers() {
            addToDebugLog('ÙØ­Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...', 'info');
            const statusElement = document.getElementById('users-count');
            
            try {
                const response = await fetch('/api/test-notifications');
                const data = await response.json();
                
                if (data.success && data.data.testUser) {
                    statusElement.innerHTML = `<span class="text-green-600">âœ… ${data.data.testUser.name}</span>`;
                    systemStats.users = 1;
                    addToDebugLog(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù…: ${data.data.testUser.name}`, 'success');
                } else {
                    throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†');
                }
            } catch (error) {
                statusElement.innerHTML = '<span class="text-red-600">âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>';
                systemStats.users = 0;
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${error.message}`, 'error');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
        async function testTestAPI() {
            const statusElement = document.getElementById('test-api-status');
            const detailsElement = document.getElementById('test-api-details');
            
            statusElement.innerHTML = '<i class="fas fa-spinner loading mr-1"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
            statusElement.className = 'api-status status-loading';
            addToDebugLog('Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ...', 'info');
            
            try {
                const response = await fetch('/api/test-notifications?limit=3');
                const data = await response.json();
                
                if (data.success) {
                    statusElement.innerHTML = '<i class="fas fa-check mr-1"></i>ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ';
                    statusElement.className = 'api-status status-success';
                    
                    detailsElement.innerHTML = `
                        <div class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Ù…ØªØµÙ„ ÙˆÙŠØ¹Ù…Ù„</div>
                        <div><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${data.data.testUser.name}</div>
                        <div><strong>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</strong> ${data.data.stats.total} (${data.data.stats.unread} Ø¬Ø¯ÙŠØ¯Ø©)</div>
                        <div class="text-xs text-green-600 mt-2">âœ… Ù‡Ø°Ø§ API ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
                    `;
                    
                    systemStats.apis.test = 'working';
                    systemStats.notifications = data.data.stats.total;
                    document.getElementById('notifications-total').innerHTML = `<span class="text-green-600">âœ… ${data.data.stats.total} Ø¥Ø´Ø¹Ø§Ø±</span>`;
                    
                    addToDebugLog(`API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ ÙŠØ¹Ù…Ù„ - ${data.data.stats.total} Ø¥Ø´Ø¹Ø§Ø±Ø§Øª`, 'success');
                } else {
                    throw new Error(data.error || 'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                statusElement.innerHTML = '<i class="fas fa-times mr-1"></i>Ø®Ø·Ø£';
                statusElement.className = 'api-status status-error';
                
                detailsElement.innerHTML = `
                    <div class="text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„</div>
                    <div class="text-sm text-gray-600">${error.message}</div>
                    <div class="text-xs text-red-600 mt-2">âš ï¸ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ùˆ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                `;
                
                systemStats.apis.test = 'failed';
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: ${error.message}`, 'error');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø´Ø§Ù…Ù„
        async function testUniversalAPI() {
            const statusElement = document.getElementById('universal-api-status');
            const detailsElement = document.getElementById('universal-api-details');
            
            statusElement.innerHTML = '<i class="fas fa-spinner loading mr-1"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
            statusElement.className = 'api-status status-loading';
            addToDebugLog('Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø´Ø§Ù…Ù„...', 'info');
            
            try {
                const response = await fetch('/api/notifications-universal?limit=3');
                const data = await response.json();
                
                if (data.success) {
                    statusElement.innerHTML = '<i class="fas fa-check mr-1"></i>ÙŠØ¹Ù…Ù„';
                    statusElement.className = 'api-status status-success';
                    
                    detailsElement.innerHTML = `
                        <div class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­</div>
                        <div><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${data.data.user.name}</div>
                        <div><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:</strong> ${data.data.user.authMethod}</div>
                        <div><strong>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</strong> ${data.data.stats.total} (${data.data.stats.unread} Ø¬Ø¯ÙŠØ¯Ø©)</div>
                        <div><strong>Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong> ${data.data.performance.responseTime}ms</div>
                    `;
                    
                    systemStats.apis.universal = 'working';
                    addToDebugLog(`API Ø§Ù„Ø´Ø§Ù…Ù„ ÙŠØ¹Ù…Ù„ Ø¨Ø·Ø±ÙŠÙ‚Ø©: ${data.data.user.authMethod}`, 'success');
                } else {
                    throw new Error(data.error || 'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                statusElement.innerHTML = '<i class="fas fa-times mr-1"></i>Ø®Ø·Ø£';
                statusElement.className = 'api-status status-error';
                
                detailsElement.innerHTML = `
                    <div class="text-red-600"><i class="fas fa-exclamation-circle mr-1"></i>ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„</div>
                    <div class="text-sm text-gray-600">${error.message}</div>
                    <div class="text-xs text-orange-600 mt-2">ğŸ’¡ Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</div>
                `;
                
                systemStats.apis.universal = 'failed';
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ API Ø§Ù„Ø´Ø§Ù…Ù„: ${error.message}`, 'error');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        async function testRealAPI() {
            const statusElement = document.getElementById('real-api-status');
            const detailsElement = document.getElementById('real-api-details');
            
            statusElement.innerHTML = '<i class="fas fa-spinner loading mr-1"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
            statusElement.className = 'api-status status-loading';
            addToDebugLog('Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ...', 'info');
            
            try {
                const response = await fetch('/api/notifications?limit=3');
                const data = await response.json();
                
                if (response.status === 401) {
                    throw new Error('ØºÙŠØ± Ù…ØµØ±Ø­ - ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„');
                }
                
                if (data.success) {
                    statusElement.innerHTML = '<i class="fas fa-check mr-1"></i>ÙŠØ¹Ù…Ù„';
                    statusElement.className = 'api-status status-success';
                    
                    detailsElement.innerHTML = `
                        <div class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­</div>
                        <div><strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${data.data.user.name}</div>
                        <div><strong>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</strong> ${data.data.stats.total} (${data.data.stats.unread} Ø¬Ø¯ÙŠØ¯Ø©)</div>
                        <div><strong>Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong> ${data.data.performance.responseTime}ms</div>
                    `;
                    
                    systemStats.apis.real = 'working';
                    addToDebugLog('API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ', 'success');
                } else {
                    throw new Error(data.error || 'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                statusElement.innerHTML = '<i class="fas fa-times mr-1"></i>ÙŠØ­ØªØ§Ø¬ Ù…ØµØ§Ø¯Ù‚Ø©';
                statusElement.className = 'api-status status-error';
                
                detailsElement.innerHTML = `
                    <div class="text-orange-600"><i class="fas fa-exclamation-triangle mr-1"></i>ØºÙŠØ± Ù…ØµØ±Ø­</div>
                    <div class="text-sm text-gray-600">${error.message}</div>
                    <div class="text-xs text-blue-600 mt-2">ğŸ’¡ ØªØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</div>
                `;
                
                systemStats.apis.real = 'needs-auth';
                addToDebugLog(`API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: ${error.message}`, 'warning');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        async function loadNotifications() {
            const apiSelector = document.getElementById('api-selector');
            const limitSelector = document.getElementById('limit-selector');
            const container = document.getElementById('notifications-container');
            const countElement = document.getElementById('notifications-count');
            
            const apiEndpoints = {
                'real': '/api/notifications',
                'universal': '/api/notifications-universal',
                'test': '/api/test-notifications'
            };
            
            const selectedAPI = apiSelector.value;
            const limit = limitSelector.value;
            const endpoint = apiEndpoints[selectedAPI];
            
            container.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner loading text-2xl text-blue-500"></i><p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...</p></div>';
            
            addToDebugLog(`ØªØ­Ù…ÙŠÙ„ ${limit} Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† ${selectedAPI} API...`, 'info');
            
            try {
                const response = await fetch(`${endpoint}?limit=${limit}`);
                const data = await response.json();
                
                if (data.success) {
                    const notifications = data.data.notifications || [];
                    countElement.textContent = notifications.length;
                    
                    if (notifications.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-12">
                                <i class="fas fa-bell-slash text-4xl text-gray-300 mb-4"></i>
                                <h3 class="text-lg font-semibold text-gray-700 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                                <p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ù…Ù† Ù‡Ø°Ø§ API</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = notifications.map((notif, index) => {
                            const isUnread = !notif.read_at;
                            const timeAgo = notif.timeAgo || getTimeAgo(notif.created_at);
                            const icon = getTypeIcon(notif.type);
                            
                            return `
                                <div class="notification-item ${isUnread ? 'notification-unread' : 'notification-read'} p-4 rounded-lg">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-start space-x-3 space-x-reverse">
                                            <div class="text-2xl">${icon}</div>
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-2 space-x-reverse mb-1">
                                                    <h4 class="font-semibold text-gray-800 text-sm">${notif.title}</h4>
                                                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">${notif.type}</span>
                                                </div>
                                                <p class="text-gray-600 text-sm mb-2">${notif.message}</p>
                                                <div class="flex items-center space-x-4 space-x-reverse text-xs text-gray-500">
                                                    <span><i class="fas fa-clock mr-1"></i>${timeAgo}</span>
                                                    <span><i class="fas fa-flag mr-1"></i>${notif.priority}</span>
                                                    ${isUnread ? '<span class="text-green-600"><i class="fas fa-circle mr-1"></i>Ø¬Ø¯ÙŠØ¯</span>' : '<span class="text-gray-400"><i class="fas fa-check mr-1"></i>Ù…Ù‚Ø±ÙˆØ¡</span>'}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 space-x-reverse">
                                            <div class="text-xs text-gray-400">#${index + 1}</div>
                                            <div class="flex items-center space-x-1 space-x-reverse">
                                                ${isUnread ? `<button onclick="markNotificationAsRead('${notif.id}')" class="text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600" title="ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡">
                                                    <i class="fas fa-check text-xs"></i>
                                                </button>` : ''}
                                                <button onclick="deleteNotificationPermanently('${notif.id}', '${notif.title.replace(/'/g, "\\'")}', ${index + 1})" class="text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹">
                                                    <i class="fas fa-trash text-xs"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    addToDebugLog(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${notifications.length} Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
                }
            } catch (error) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <h3 class="text-lg font-semibold text-red-700 mb-2">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</h3>
                        <p class="text-red-600 text-sm">${error.message}</p>
                        <button onclick="loadNotifications()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 text-sm">
                            <i class="fas fa-retry mr-2"></i>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                        </button>
                    </div>
                `;
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${error.message}`, 'error');
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
        async function createTestNotification() {
            addToDebugLog('Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ...', 'info');
            
            try {
                const response = await fetch('/api/test-notifications', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        source: 'admin-debugger',
                        timestamp: new Date().toISOString()
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addToDebugLog('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø®ØªØ§Ø±
                    if (document.getElementById('api-selector').value === 'test') {
                        await loadNotifications();
                    }
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
                }
            } catch (error) {
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${error.message}`, 'error');
            }
        }

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø©
        async function cleanupBrokenNotifications() {
            addToDebugLog('Ø¨Ø¯Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø©...', 'warning');
            
            try {
                const response = await fetch('/api/test-notifications/cleanup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addToDebugLog(`ØªÙ… Ø­Ø°Ù ${data.data.cleanup.deleted} Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙƒØ³ÙˆØ±Ø©`, 'success');
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
                    data.data.broken_details.forEach((notif, index) => {
                        addToDebugLog(`${index + 1}. ${notif.title} - ${notif.reason}`, 'warning');
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    document.getElementById('notifications-total').innerHTML = 
                        `<span class="text-green-600">âœ… ${data.data.stats_after.total} Ø¥Ø´Ø¹Ø§Ø± (Ù…Ù†Ø¸Ù)</span>`;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø­Ù…Ù„Ø©
                    if (document.getElementById('api-selector').value === 'test') {
                        await loadNotifications();
                    }
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ');
                }
            } catch (error) {
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ: ${error.message}`, 'error');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ­ÙˆØµØ§Øª
        async function refreshAll() {
            addToDebugLog('ØªØ­Ø¯ÙŠØ« Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ­ÙˆØµØ§Øª...', 'info');
            await Promise.all([
                checkDatabase(),
                checkUsers(),
                testTestAPI(),
                testUniversalAPI(),
                testRealAPI()
            ]);
            addToDebugLog('ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ù…Ù„', 'success');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        function exportLogs() {
            const data = {
                timestamp: new Date().toISOString(),
                systemStats: systemStats,
                debugLog: debugLog,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `notifications-debug-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addToDebugLog('ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'success');
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ…Ù‚Ø±ÙˆØ¡
        async function markNotificationAsRead(notificationId) {
            addToDebugLog(`ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ${notificationId} ÙƒÙ…Ù‚Ø±ÙˆØ¡...`, 'info');
            
            try {
                const response = await fetch('/api/test-notifications/mark-read-single', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        notificationId: notificationId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addToDebugLog(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ…Ù‚Ø±ÙˆØ¡ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    await loadNotifications();
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
                }
            } catch (error) {
                addToDebugLog(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${error.message}`, 'error');
            }
        }

        // Ø­Ø°Ù Ø¥Ø´Ø¹Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
        async function deleteNotificationPermanently(notificationId, title, index) {
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± "${title}" Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
                return;
            }
            
            addToDebugLog(`Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± #${index} (${notificationId}) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹...`, 'warning');
            
            try {
                const response = await fetch('/api/test-notifications/delete-single', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        notificationId: notificationId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addToDebugLog(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± "${title}" Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹`, 'success');
                    addToDebugLog(`Ù…ØªØ¨Ù‚ÙŠ: ${data.data.totalRemaining} Ø¥Ø´Ø¹Ø§Ø± (${data.data.remainingUnread} ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡)`, 'info');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    await loadNotifications();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¥Ù† ÙˆÙØ¬Ø¯Øª
                    document.getElementById('notifications-total').innerHTML = 
                        `<span class="text-green-600">âœ… ${data.data.totalRemaining} Ø¥Ø´Ø¹Ø§Ø±</span>`;
                        
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
                }
            } catch (error) {
                addToDebugLog(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ${error.message}`, 'error');
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function getTimeAgo(dateStr) {
            const now = new Date();
            const date = new Date(dateStr);
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Ø§Ù„Ø¢Ù†';
            if (diffMins < 60) return `Ù…Ù†Ø° ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (diffMins < 1440) return `Ù…Ù†Ø° ${Math.floor(diffMins / 60)} Ø³Ø§Ø¹Ø©`;
            return `Ù…Ù†Ø° ${Math.floor(diffMins / 1440)} ÙŠÙˆÙ…`;
        }

        function getTypeIcon(type) {
            const icons = {
                'breaking_news': 'âš¡',
                'article_recommendation': 'ğŸ“°',
                'user_engagement': 'ğŸ‘¥',
                'system_alert': 'ğŸ””',
                'ai_insight': 'ğŸ¤–',
                'daily_digest': 'ğŸ“Š',
                'comment_reply': 'ğŸ’¬',
                'author_follow': 'â­'
            };
            return icons[type] || 'ğŸ””';
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        window.addEventListener('load', async function() {
            addToDebugLog('ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØµØ­Ø­...', 'info');
            
            // ÙØ­ÙˆØµØ§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            await checkDatabase();
            await checkUsers();
            
            // Ø«Ù… ÙØ­Øµ APIs
            await testTestAPI();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† API Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            document.getElementById('api-selector').value = 'test';
            await loadNotifications();
            
            addToDebugLog('Ø§Ù„Ù…ØµØ­Ø­ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', 'success');
        });
    </script>
</body>
</html>
