#!/bin/bash

echo "๐ ุฅุตูุงุญ ุณุฑูุน ููุฅูุชุงุฌ"
echo "===================="

# 1. ุชูููุฏ Prisma Client
echo "1๏ธโฃ ุชูููุฏ Prisma Client..."
npx prisma generate

# 2. ุจูุงุก ุงูุชุทุจูู ุฅุฐุง ูุฒู
if [ ! -d ".next" ]; then
    echo "2๏ธโฃ ุจูุงุก ุงูุชุทุจูู..."
    npm run build
else
    echo "2๏ธโฃ ุงูุชุทุจูู ูุจูู ูุณุจูุงู โ"
fi

# 3. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
echo "3๏ธโฃ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู..."
if command -v pm2 &> /dev/null; then
    pm2 restart all
    pm2 save
    echo "โ ุชู ุฅุนุงุฏุฉ ุงูุชุดุบูู ุนุจุฑ PM2"
else
    # ุฅุฐุง ูู ููู PM2 ููุฌูุฏุงูุ ุญุงูู ุฅููุงู ูุชุดุบูู ุงูุนูููุฉ
    pkill -f "node.*next" || true
    sleep 2
    npm start &
    echo "โ ุชู ุชุดุบูู ุงูุชุทุจูู"
fi

# 4. ุงูุชุธุงุฑ ุจุฏุก ุงูุชุทุจูู
echo "โณ ุงูุชุธุงุฑ ุจุฏุก ุงูุชุทุจูู..."
sleep 5

# 5. ุงุฎุชุจุงุฑ ุณุฑูุน
echo "๐ ุงุฎุชุจุงุฑ ุณุฑูุน..."
curl -s http://localhost:3000/api/health | grep -q "healthy" && echo "โ API ูุนูู!" || echo "โ API ูุง ูุนูู"

echo ""
echo "โจ ุงูุชูู ุงูุฅุตูุงุญ ุงูุณุฑูุน!"
echo "๐ ุงุฎุชุจุฑ ุงููููุน: https://jur3a.ai" 