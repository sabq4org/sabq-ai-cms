#!/bin/bash
# ุณูุฑูุจุช ุงูุทูุงุฑุฆ ูุชุดุบูู ุจูุฆุฉ ุงูุชุทููุฑ ุงููุญููุฉ

echo "๐จ ุจุฏุก ุชุดุบูู ุจูุฆุฉ ุงูุชุทููุฑ ุงููุญููุฉ ููุทูุงุฑุฆ..."
echo "ูุฐุง ุงูุณูุฑูุจุช ุณูุถูู ุฃูู ุชุณุชุทูุน ุงูุนูู ูุญููุงู ุจูููุง ูุชู ุญู ูุดููุฉ Vercel."
echo "------------------------------------------------------------------"

# 1. ุงูุชุฃูุฏ ูู ูุฌูุฏ ููู .env.local
if [ ! -f .env.local ]; then
    echo "โ ูู ูุชู ุงูุนุซูุฑ ุนูู ููู .env.local. ูุฑุฌู ุชุดุบูู 'scripts/setup-environment.sh' ุฃููุงู ูุงูุชุฃูุฏ ูู ูุถุน ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุตุญูุญ ููู."
    exit 1
fi
echo "โ ุชู ุงูุนุซูุฑ ุนูู .env.local."

# 2. ุงูุชุฃูุฏ ูู ุฃู node_modules ููุฌูุฏุฉ
if [ ! -d "node_modules" ]; then
    echo "๐ฆ ูุฌูุฏ node_modules ุบูุฑ ููุฌูุฏ. ูุชู ุงูุชุซุจูุช ุงูุขู..."
    npm install
fi
echo "โ ูุฌูุฏ node_modules ููุฌูุฏ."

# 3. ุงูุชุฃูุฏ ูู ุฃู Prisma Client ูุญุฏูุซ
echo "๐ง ูุชู ุงูุชุฃูุฏ ูู ุชุญุฏูุซ Prisma Client..."
npx prisma generate
echo "โ Prisma Client ูุญุฏูุซ."

# 4. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจุงูุฏุงุชุงุจูุณ ูุฑุฉ ุฃุฎูุฑุฉ
echo "๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช..."
node -e "require('dotenv').config({ path: '.env.local' }); const { PrismaClient } = require('./lib/generated/prisma'); const prisma = new PrismaClient(); prisma.\$connect().then(() => { console.log('โโโ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนูู ุจูุฌุงุญ!'); process.exit(0); }).catch((e) => { console.error('โโโ ูุดู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช! ุงูุฎุทุฃ:', e.message); process.exit(1); });"
if [ $? -ne 0 ]; then
    echo "๐ ุชููู! ูุง ูููู ุชุดุบูู ุงูุฎุงุฏู ูุฃู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุดู. ูุฑุฌู ูุฑุงุฌุนุฉ ููู .env.local."
    exit 1
fi

# 5. ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ
echo "๐ ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ ุงููุญูู ุนูู http://localhost:3000"
echo "โน๏ธ ูุฅููุงู ุงูุฎุงุฏูุ ุงุถุบุท ุนูู CTRL+C ูู ูุฐุง ุงูุชูุฑููุงู."
echo "------------------------------------------------------------------"

# ูุชุญ ุงููุชุตูุญ (ูุนูู ุนูู macOS ูุจุนุถ ุฃูุธูุฉ Linux)
# open http://localhost:3000/dashboard

# ุจุฏุก ุงูุฎุงุฏู
npm run dev 