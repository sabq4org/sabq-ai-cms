# نظام تحليلات التفاعل وسلوك المستخدمين

## نظرة عامة
لوحة تحليلات متقدمة لرصد تفاعل المستخدمين وتحليل سلوكهم، مع تحديث تلقائي للتفضيلات وربط بنظام الولاء.

## المسارات والملفات

### 1. صفحة لوحة التحليلات
- **المسار**: `/dashboard/insights/behavior`
- **الملف**: `/app/dashboard/insights/behavior/page.tsx`
- **الوصف**: واجهة المستخدم الرئيسية لعرض التحليلات

### 2. API البيانات
- **المسار**: `/api/dashboard/insights/behavior`
- **الملف**: `/app/api/dashboard/insights/behavior/route.ts`
- **الوصف**: جلب وتحليل بيانات التفاعل

### 3. API التفاعلات
- **المسار**: `/api/interactions/track`
- **الملف**: `/app/api/interactions/track/route.ts`
- **الوصف**: تسجيل التفاعلات وتحديث التفضيلات والنقاط

## المكونات الرئيسية

### البطاقات الإحصائية
1. **المستخدمون النشطون**: عدد المستخدمين الذين تفاعلوا خلال 7 أيام
2. **إجمالي التفاعلات**: مجموع جميع أنواع التفاعل
3. **النقاط الممنوحة**: إجمالي نقاط الولاء المكتسبة
4. **متوسط التفاعل**: متوسط التفاعلات لكل مستخدم
5. **المقالات المنشورة**: عدد المقالات المتاحة

### أنواع التفاعلات المتتبعة
- **القراءة (Read)**: 5 نقاط - يتطلب 30 ثانية و 50% تمرير
- **الإعجاب (Like)**: 10 نقاط
- **المشاركة (Share)**: 15 نقطة
- **التعليق (Comment)**: 20 نقطة
- **الحفظ (Save)**: 10 نقاط
- **المشاهدة (View)**: 1 نقطة - يتطلب 5 ثواني

### جدول البيانات

#### user_article_interactions.json
```json
{
  "interactions": [
    {
      "id": "interaction-xxx",
      "user_id": "user-123",
      "article_id": "article-456",
      "interaction_type": "read",
      "category_id": 2,
      "duration": 45,
      "scroll_percentage": 85.5,
      "timestamp": "2025-06-18T10:30:00Z",
      "points_earned": 5
    }
  ]
}
```

#### user_preferences.json
```json
{
  "preferences": [
    {
      "user_id": "user-123",
      "categories": {
        "رياضة": { "weight": 0.8, "last_updated": "2025-06-18" },
        "اقتصاد": { "weight": 0.5, "last_updated": "2025-06-17" }
      }
    }
  ]
}
```

#### user_loyalty_points.json
```json
{
  "users": [
    {
      "user_id": "user-123",
      "total_points": 1250,
      "earned_points": 1250,
      "redeemed_points": 0,
      "tier": "silver",
      "last_updated": "2025-06-18T10:30:00Z"
    }
  ]
}
```

## أوزان التفضيلات
عند كل تفاعل، يتم تحديث وزن التصنيف المرتبط:
- **مشاهدة**: +0.1
- **قراءة**: +0.5
- **إعجاب**: +0.3
- **مشاركة**: +0.7
- **تعليق**: +0.8
- **حفظ**: +0.6

## مستويات الولاء
- **Bronze**: 0-999 نقطة
- **Silver**: 1,000-4,999 نقطة
- **Gold**: 5,000-9,999 نقطة
- **Platinum**: 10,000+ نقطة

## ميزات الصفحة

### 1. التحديث التلقائي
- تحديث البيانات كل 5 دقائق
- زر تحديث يدوي متاح

### 2. الرسوم البيانية
- **مخطط دائري**: توزيع أنواع التفاعلات
- **أعمدة أفقية**: التصنيفات الأكثر تفاعلاً

### 3. جدول المستخدمين النشطين
- الاسم والصورة الرمزية
- عدد التفاعلات
- النقاط المكتسبة
- المستوى الحالي
- التصنيف المفضل
- تاريخ آخر نشاط

### 4. التصدير
- زر تصدير البيانات (جاهز للتطوير المستقبلي)

## منع التلاعب
- تفاعل واحد من نفس النوع كل 24 ساعة
- التحقق من مدة القراءة ونسبة التمرير
- استبعاد المستخدمين المجهولين من النقاط

## التكامل مع الأنظمة الأخرى

### 1. نظام التوصيات
- استخدام أوزان التفضيلات لتحسين التوصيات
- تحديد المحتوى المناسب لكل مستخدم

### 2. نظام الولاء
- منح النقاط تلقائياً عند التفاعل
- تحديث المستويات بناءً على النقاط

### 3. التخصيص الذكي
- تحليل السلوك لتحسين تجربة المستخدم
- عرض محتوى مخصص في الصفحة الرئيسية

## الأداء والتحسينات
- جلب البيانات بشكل متوازي
- تصفية التفاعلات لآخر 7 أيام فقط
- استخدام الذاكرة المؤقتة للبيانات الثابتة
- رسوم متحركة سلسة مع Framer Motion

## الأمان
- التحقق من هوية المستخدم قبل منح النقاط
- حماية من التفاعلات المكررة
- تسجيل جميع العمليات للمراجعة

## خطط التطوير المستقبلية
1. إضافة فلاتر زمنية مخصصة
2. تصدير التقارير بصيغ مختلفة (PDF, Excel)
3. رسوم بيانية متقدمة للاتجاهات
4. تنبيهات للأنماط غير الطبيعية
5. مقارنة الأداء بين الفترات الزمنية 