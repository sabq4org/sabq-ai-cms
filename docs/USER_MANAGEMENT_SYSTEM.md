# ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุงููุชูุฏู - ุณุจู ุงูุฐููุฉ

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุงููุชูุฏู ููููู ูุชูุงููุงู ูุน ูุดุฑูุน ุณุจู ุงูุฐููุฉ ุงูุญุงููุ ุจุงุณุชุฎุฏุงู ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุชูููุงุช ุงูููุฌูุฏุฉ ูุน ุฅุถุงูุฉ ูุนุงููุฑ ุฃูุงู ูุชูุฏูุฉ ูุฃูุถู ุงูููุงุฑุณุงุช ุงูุนุงูููุฉ.

## ุงูุฎุตุงุฆุต ุงูุฑุฆูุณูุฉ

### ๐ ุงูุฃูุงู ุงููุชูุฏู
- ุชุดููุฑ ูููุงุช ุงููุฑูุฑ ุจุงุณุชุฎุฏุงู bcrypt ูุน salt rounds ุนุงููุฉ (12)
- JWT tokens ูุน ุชูุงููุช ุงูุชูุงุก ูุตูุฑุฉ ููุฃูุงู
- Refresh tokens ุขููุฉ ูุน ุชุดููุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุญูุงูุฉ ูู Rate Limiting ููุญูุงูุฉ ูู ูุฌูุงุช brute force
- ุชุณุฌูู ุดุงูู ููุฃุญุฏุงุซ ุงูุฃูููุฉ
- ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ (PII) ุจุงุณุชุฎุฏุงู AES-256-GCM

### ๐ค ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- ุชุณุฌูู ูุณุชุฎุฏููู ุฌุฏุฏ ูุน ุงูุชุญูู ูู ุงูุจูุงูุงุช
- ุชุณุฌูู ุงูุฏุฎูู ูุงูุฎุฑูุฌ ุงูุขูู
- ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ุงููุชุนุฏุฏุฉ
- ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู
- ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ูุน ุงูุชุญูู ูู ุงูููุฉ
- ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

### ๐ก๏ธ ุงูุญูุงูุฉ ุงููุชูุฏูุฉ
- ูุดู ุงููุดุงุท ุงููุดุจูู
- ุญุธุฑ ุงูุญุณุงุจุงุช ุจุนุฏ ูุญุงููุงุช ูุงุดูุฉ ูุชูุฑุฑุฉ
- ุชุญููู ุฃููุงุท ุงููุตูู
- ุญุฏ ุฃูุตู ููุฌูุณุงุช ุงููุชุฒุงููุฉ
- ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฌูุณุงุช ุชููุงุฆูุงู

## ูููู ุงููุดุฑูุน

```
lib/auth/
โโโ user-management.ts          # ุงูุฎุฏูุงุช ุงูุฃุณุงุณูุฉ
โโโ middleware.ts               # ูุณุทุงุก ุงููุตุงุฏูุฉ
โโโ security-standards.ts       # ูุนุงููุฑ ุงูุฃูุงู ุงููุชูุฏูุฉ

app/api/auth/
โโโ register/route.ts           # ุชุณุฌูู ุงููุณุชุฎุฏููู
โโโ login/route.ts              # ุชุณุฌูู ุงูุฏุฎูู
โโโ logout/route.ts             # ุชุณุฌูู ุงูุฎุฑูุฌ
โโโ refresh/route.ts            # ุชุฌุฏูุฏ ุงูุฑููุฒ
โโโ profile/route.ts            # ุฅุฏุงุฑุฉ ุงูููู ุงูุดุฎุตู
โโโ change-password/route.ts    # ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
โโโ reset-password/route.ts     # ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ

__tests__/
โโโ auth/user-management.test.ts # ุงุฎุชุจุงุฑุงุช ุงูุฎุฏูุงุช
โโโ api/auth.test.ts            # ุงุฎุชุจุงุฑุงุช APIs
```

## ุงูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู

ุงููุธุงู ูุจูู ููุชูุงูู ุงููุงูู ูุน:
- โ ูููุฐุฌ `users` ุงูููุฌูุฏ ูู Prisma
- โ ูููุฐุฌ `RefreshToken` ููุฃูุงู
- โ ูููุฐุฌ `UserSessions` ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
- โ ูููุฐุฌ `password_reset_tokens` ูุฅุนุงุฏุฉ ุงูุชุนููู
- โ ูููุฐุฌ `activity_logs` ูููุฑุงูุจุฉ

## ุงูุงุณุชุฎุฏุงู

### 1. ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ

```typescript
import { UserManagementService } from '@/lib/auth/user-management';

const result = await UserManagementService.registerUser({
  email: 'user@example.com',
  password: 'SecurePass123!',
  name: 'ุงุณู ุงููุณุชุฎุฏู',
  role: 'user',
  phone: '+966501234567',
  city: 'ุงูุฑูุงุถ',
  country: 'SA',
  interests: ['ุชูููุฉ', 'ุฃุฎุจุงุฑ'],
  preferred_language: 'ar'
});
```

### 2. ุชุณุฌูู ุงูุฏุฎูู

```typescript
const result = await UserManagementService.loginUser({
  email: 'user@example.com',
  password: 'SecurePass123!',
  remember_me: false
}, {
  ip_address: '192.168.1.1',
  user_agent: 'Browser/1.0',
  device_type: 'desktop'
});
```

### 3. ุงุณุชุฎุฏุงู Middleware

```typescript
import { authMiddleware, adminMiddleware } from '@/lib/auth/middleware';

// ูู API route
export async function GET(request: NextRequest) {
  const authResult = await authMiddleware(request);
  
  if (!authResult.success) {
    return NextResponse.json({ error: 'ุบูุฑ ูุตุฑุญ' }, { status: 401 });
  }
  
  // ูุชุงุจุนุฉ ุงููุนุงูุฌุฉ...
}
```

## APIs ุงููุชุงุญุฉ

### POST `/api/auth/register`
ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ

**Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "name": "ุงุณู ุงููุณุชุฎุฏู",
  "role": "user",
  "phone": "+966501234567",
  "city": "ุงูุฑูุงุถ"
}
```

### POST `/api/auth/login`
ุชุณุฌูู ุงูุฏุฎูู

**Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "remember_me": false
}
```

### GET `/api/auth/profile`
ุงูุญุตูู ุนูู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุญุงูู

**Headers:**
```
Authorization: Bearer <access_token>
```

### PUT `/api/auth/profile`
ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู

**Headers:**
```
Authorization: Bearer <access_token>
```

**Body:**
```json
{
  "name": "ุงุณู ุฌุฏูุฏ",
  "city": "ุฌุฏุฉ",
  "phone": "+966509876543"
}
```

### POST `/api/auth/change-password`
ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

**Headers:**
```
Authorization: Bearer <access_token>
```

**Body:**
```json
{
  "current_password": "OldPass123!",
  "new_password": "NewPass123!",
  "confirm_password": "NewPass123!"
}
```

### POST `/api/auth/reset-password`
ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ

**ูุทูุจ ุงูุฅุนุงุฏุฉ:**
```json
{
  "email": "user@example.com"
}
```

**ูุชุฃููุฏ ุงูุฅุนุงุฏุฉ:**
```json
{
  "token": "reset_token_here",
  "new_password": "NewPass123!"
}
```

### POST `/api/auth/refresh`
ุชุฌุฏูุฏ access token

**Body:**
```json
{
  "refresh_token": "refresh_token_here"
}
```

### POST `/api/auth/logout`
ุชุณุฌูู ุงูุฎุฑูุฌ

**Headers:**
```
Authorization: Bearer <access_token>
```

## ูุนุงููุฑ ุงูุฃูุงู

### ูููุงุช ุงููุฑูุฑ
- ุญุฏ ุฃุฏูู 8 ุฃุญุฑู
- ูุฌุจ ุฃู ุชุญุชูู ุนูู: ุญุฑู ูุจูุฑุ ุญุฑู ุตุบูุฑุ ุฑููุ ุฑูุฒ ุฎุงุต
- ุชุดููุฑ ุจุงุณุชุฎุฏุงู bcrypt ูุน 12 salt rounds
- ูุญุต ููุฉ ูููุฉ ุงููุฑูุฑ ุนูุฏ ุงูุชุณุฌูู

### ุงูุฌูุณุงุช
- ุงูุชูุงุก ุตูุงุญูุฉ ุชููุงุฆู ุจุนุฏ 30 ุฏูููุฉ ูู ุนุฏู ุงููุดุงุท
- ุญุฏ ุฃูุตู 5 ุฌูุณุงุช ูุชุฒุงููุฉ ููู ูุณุชุฎุฏู
- ุชุณุฌูู ุฌููุน ุฃูุดุทุฉ ุงูุฌูุณุฉ

### ุงูุญูุงูุฉ ูู ุงููุฌูุงุช
- Rate limiting: 5 ูุญุงููุงุช ุชุณุฌูู ุฏุฎูู ูู 15 ุฏูููุฉ
- ุญุธุฑ ูุคูุช ููุญุณุงุจุงุช ุจุนุฏ 10 ูุญุงููุงุช ูุงุดูุฉ
- ูุดู ูููุน ุงููุดุงุท ุงููุดุจูู
- ุชุณุฌูู ุดุงูู ููุฃุญุฏุงุซ ุงูุฃูููุฉ

### ุชุดููุฑ ุงูุจูุงูุงุช
- ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูุดูุฑุฉ ุจุงุณุชุฎุฏุงู AES-256-GCM
- ููุงุชูุญ ุงูุชุดููุฑ ูููุตูุฉ ููุญููุฉ
- ุชุดููุฑ cookies ููุญุชููุงุชูุง

## ุงูุงุฎุชุจุงุฑุงุช

```bash
# ุชุดุบูู ุฌููุน ุงุฎุชุจุงุฑุงุช ุงููุตุงุฏูุฉ
npm test -- __tests__/auth/

# ุชุดุบูู ุงุฎุชุจุงุฑุงุช APIs
npm test -- __tests__/api/auth.test.ts

# ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงูุฎุฏูุงุช
npm test -- __tests__/auth/user-management.test.ts
```

## ุงููุฑุงูุจุฉ ูุงูุชุญููู

ุงููุธุงู ูููุฑ:
- ุชุณุฌูู ุดุงูู ููุฃุญุฏุงุซ ุงูุฃูููุฉ ูู `activity_logs`
- ุชุญููู ุฃููุงุท ุงููุตูู ุงููุดุจููุฉ
- ุชูุจููุงุช ููุฃุญุฏุงุซ ุงูุฃูููุฉ ุงูุฎุทูุฑุฉ
- ุฅุญุตุงุฆูุงุช ุงูุฌูุณุงุช ูุงููุณุชุฎุฏููู

## ุงูุชูููู

ูู ุจุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ุฅูู `.env`:

```env
# JWT Security
JWT_SECRET="your-super-secret-jwt-key-min-64-chars"
JWT_EXPIRES_IN="15m"
REFRESH_TOKEN_EXPIRES_IN="30d"

# ุชุดููุฑ ุงูุจูุงูุงุช
PII_ENCRYPTION_KEY="your-pii-encryption-key-min-32-chars"

# ูุนุงููุฑ ุงูุฃูุงู
ENABLE_RATE_LIMITING="true"
ENABLE_SECURITY_LOGGING="true"
SESSION_TIMEOUT_MINUTES="30"
MAX_CONCURRENT_SESSIONS="5"
```

## ุงูุตูุงูุฉ

### ุชูุธูู ุงูุฌูุณุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ
```typescript
import { SessionManager } from '@/lib/auth/security-standards';

// ูููุตุญ ุจุชุดุบููู ููููุงู
await SessionManager.cleanupExpiredSessions();
```

### ูุฑุงุฌุนุฉ ุงูุฃุญุฏุงุซ ุงูุฃูููุฉ
```sql
-- ุงูุฃุญุฏุงุซ ุงูุฃูููุฉ ูู ุขุฎุฑ 24 ุณุงุนุฉ
SELECT * FROM activity_logs 
WHERE entity_type = 'security_event' 
AND created_at >= NOW() - INTERVAL '24 hours'
ORDER BY created_at DESC;
```

## ุงูุชุทููุฑ ุงููุณุชูุจูู

- [ ] ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ (2FA)
- [ ] ุชุณุฌูู ุงูุฏุฎูู ุจูุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู
- [ ] ุฅุฏุงุฑุฉ ุงูุฃุฐููุงุช ุงููุชูุฏูุฉ (RBAC)
- [ ] ุชุญููู ุณููู ุงููุณุชุฎุฏู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
- [ ] ุชูุงูู ูุน ุฎุฏูุงุช ุฃูุงู ุฎุงุฑุฌูุฉ

## ุงูุฏุนู ูุงููุณุงููุฉ

ููุงุณุชูุณุงุฑุงุช ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู ุฃูููุฉ:
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: security@sabq.ai
- ูู ุญุงูุฉ ุงูุทูุงุฑุฆ ุงูุฃูููุฉ: ููุฑู ุนุจุฑ ุงููููุงุช ุงูุฏุงุฎููุฉ

---

**ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ูููุงู ูุฃูุถู ุงูููุงุฑุณุงุช ุงูุนุงูููุฉ ูู ุงูุฃูุงู ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู.**
