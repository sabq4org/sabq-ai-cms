# دليل إعداد البريد الإلكتروني لموقع jur3a.ai

## معلومات البريد الإلكتروني

### بيانات الحساب:
- **البريد الإلكتروني**: `noreplay@jur3a.ai`
- **كلمة المرور**: `oFWD[H,A8~8;iw7(`

### إعدادات الخادم:

#### البريد الصادر (SMTP):
- **الخادم**: `mail.jur3a.ai`
- **المنفذ**: `465`
- **الأمان**: `SSL/TLS`

#### البريد الوارد (IMAP):
- **الخادم**: `mail.jur3a.ai`
- **المنفذ**: `993`
- **الأمان**: `SSL/TLS`

#### البريد الوارد (POP3):
- **الخادم**: `mail.jur3a.ai`
- **المنفذ**: `995`
- **الأمان**: `SSL/TLS`

## خطوات الإعداد

### 1. إنشاء ملف `.env.local`

قم بإنشاء ملف `.env.local` في جذر المشروع وأضف الإعدادات التالية:

```env
# إعدادات البريد الإلكتروني
SMTP_HOST=mail.jur3a.ai
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=noreplay@jur3a.ai
SMTP_PASS=oFWD[H,A8~8;iw7(
EMAIL_FROM=noreplay@jur3a.ai
EMAIL_FROM_NAME="صحيفة سبق الإلكترونية"

# إعدادات الموقع
NEXT_PUBLIC_SITE_URL=https://jur3a.ai
NEXT_PUBLIC_API_URL=https://jur3a.ai/api
```

### 2. تثبيت المكتبات المطلوبة

```bash
npm install nodemailer
npm install --save-dev @types/nodemailer
```

### 3. استخدام خدمة البريد

#### إرسال بريد التحقق:
```typescript
import { emailService } from '@/lib/email-service';

// إرسال رمز التحقق
const code = generateVerificationCode();
await emailService.sendVerificationEmail(
  'user@example.com',
  'اسم المستخدم',
  code
);
```

#### إرسال بريد الترحيب:
```typescript
await emailService.sendWelcomeEmail(
  'user@example.com',
  'اسم المستخدم'
);
```

#### إرسال بريد استرجاع كلمة المرور:
```typescript
await emailService.sendPasswordResetEmail(
  'user@example.com',
  'اسم المستخدم',
  'reset-token-here'
);
```

#### إرسال رد على رسائل الزوار:
```typescript
await emailService.sendContactReply(
  'visitor@example.com',
  'اسم الزائر',
  'موضوع الرسالة',
  'نص الرد على الرسالة'
);
```

#### إرسال إشعار للإدارة عند استلام رسالة جديدة:
```typescript
await emailService.sendNewContactNotification(
  'admin@jur3a.ai',
  {
    name: 'اسم المرسل',
    email: 'sender@example.com',
    subject: 'موضوع الرسالة',
    message: 'نص الرسالة'
  }
);
```

## أنواع الرسائل المدعومة

### 1. رسائل التحقق من البريد الإلكتروني
- تُرسل عند تسجيل حساب جديد
- تحتوي على رمز تحقق من 6 أرقام
- صالحة لمدة 10 دقائق

### 2. رسائل الترحيب
- تُرسل بعد تأكيد البريد الإلكتروني
- تحتوي على معلومات عن مميزات العضوية
- رابط مباشر للبدء في استخدام الموقع

### 3. رسائل استرجاع كلمة المرور
- تُرسل عند طلب إعادة تعيين كلمة المرور
- تحتوي على رابط آمن لإعادة التعيين
- الرابط صالح لمدة ساعة واحدة

### 4. رسائل الرد على الزوار
- تُرسل كرد على رسائل نموذج "اتصل بنا"
- تحتوي على الرد المخصص من الإدارة

### 5. إشعارات الإدارة
- تُرسل للإدارة عند استلام رسالة جديدة
- تحتوي على تفاصيل المرسل والرسالة
- رابط مباشر للرد على الرسالة

## ميزات النظام

### 1. إعادة المحاولة التلقائية
- عند فشل إرسال رسالة، يعيد النظام المحاولة 3 مرات
- فترة انتظار 5 ثوانٍ بين كل محاولة

### 2. قوالب HTML احترافية
- تصميم متجاوب مع جميع الأجهزة
- دعم كامل للغة العربية (RTL)
- ألوان متناسقة مع هوية الموقع

### 3. سجلات مفصلة
- تسجيل جميع عمليات الإرسال الناجحة
- تسجيل الأخطاء مع التفاصيل
- معلومات عن المحاولات المتكررة

## استكشاف الأخطاء

### خطأ في الاتصال:
```
❌ خطأ في إعدادات البريد الإلكتروني: Error: connect ETIMEDOUT
```
**الحل**: تأكد من صحة إعدادات الخادم والمنفذ

### خطأ في المصادقة:
```
❌ خطأ في إعدادات البريد الإلكتروني: Error: Invalid login
```
**الحل**: تأكد من صحة اسم المستخدم وكلمة المرور

### خطأ في الشهادة:
```
❌ خطأ في إعدادات البريد الإلكتروني: Error: self signed certificate
```
**الحل**: قد تحتاج لإضافة `tls: { rejectUnauthorized: false }` في إعدادات nodemailer (للتطوير فقط)

## الأمان

1. **لا تحفظ كلمة المرور في الكود**: استخدم دائماً متغيرات البيئة
2. **استخدم SSL/TLS**: تأكد من تشفير الاتصال
3. **قيّد معدل الإرسال**: لتجنب إساءة الاستخدام
4. **سجل جميع العمليات**: لمراقبة أي نشاط مشبوه

## الصيانة

### فحص دوري:
- تحقق من سجلات الإرسال أسبوعياً
- راجع الرسائل المرتدة
- حدّث كلمة المرور كل 3 أشهر

### النسخ الاحتياطي:
- احتفظ بنسخة من قوالب البريد
- احفظ سجلات الإرسال المهمة
- وثّق أي تغييرات في الإعدادات 