# تطبيق المعرفات الفريدة للمقالات

## المشكلة

كانت الروابط العربية تسبب مشاكل في الموقع المباشر:
- الروابط العربية تُرمز بـ URL encoding مما يجعلها طويلة وصعبة القراءة
- حدوث أخطاء "المقال غير متوفر" بسبب مشاكل في فك الترميز
- صعوبة في مشاركة الروابط

مثال على رابط مشكل:
```
https://sabq.io/article/تصل-إلى-48-درجة-مئوية-الأرصاد-موجة-حارة-على-المنطقة-الشرقية
```

## الحل المطبق

تم استبدال الروابط العربية بمعرفات فريدة قصيرة وآمنة.

### 1. نظام المعرفات الجديد

- **الصيغة**: `art-YYYYMM-random` (مثال: `art-202501-abc123`)
- **المكونات**:
  - `art`: بادئة للتعريف
  - `YYYYMM`: السنة والشهر
  - `random`: 7 أحرف عشوائية

### 2. التحديثات المطبقة

#### أ. دوال توليد المعرفات (`lib/slug-utils.ts`)
```typescript
export function generateUniqueId(prefix: string = 'art'): string
export function getArticleIdentifier(article: { id?: string; slug?: string; title?: string }): string
```

#### ب. تحديث روابط المقالات (`lib/utils.ts`)
- استخدام `getArticleIdentifier()` بدلاً من slug مباشرة
- ضمان عدم استخدام روابط عربية

#### ج. إنشاء المقالات (`app/api/articles/route.ts`)
- إضافة دالة POST جديدة
- توليد معرف فريد تلقائياً عند إنشاء مقال
- حفظ المعرف في حقلي `id` و `slug`

#### د. تحسين رسائل الخطأ (`app/article/[id]/page.tsx`)
- إزالة عرض المعرف التقني
- إضافة زر للعودة للرئيسية
- تحسين تصميم صفحة الخطأ

### 3. تحديث المقالات الموجودة

تم إنشاء سكريبت `scripts/update-articles-with-unique-ids.js` لتحديث المقالات الموجودة:
```bash
npm run prisma:generate
node scripts/update-articles-with-unique-ids.js
```

## الفوائد

1. **روابط قصيرة وواضحة**: `https://sabq.io/article/art-202501-abc123`
2. **لا مشاكل ترميز**: معرفات آمنة بأحرف إنجليزية فقط
3. **سهولة المشاركة**: روابط قصيرة يمكن نسخها ومشاركتها بسهولة
4. **أداء أفضل**: لا حاجة لفك ترميز معقد

## ملاحظات مهمة

- المعرفات القديمة (UUID) ما زالت تعمل للتوافق مع الإصدارات السابقة
- يتم فحص المعرف بثلاث طرق: id، slug، وفك الترميز
- النظام يولد معرفات فريدة تلقائياً للمقالات الجديدة 