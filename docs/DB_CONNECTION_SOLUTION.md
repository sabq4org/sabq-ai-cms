# ุญู ูุดููุฉ ุงููุทุงุน ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ฏ ููุฎุต ุงูุญู

ุชู ุชุทุจูู ุญู ุดุงูู ููุนุงูุฌุฉ ูุดููุฉ ุงููุทุงุน ุงูุงุชุตุงู ุงููุชูุฑุฑ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฐู ูุงู ูุคุซุฑ ุนูู ูุธุงู ุงูุชุตูููุงุช ูุงูุฃุฎุจุงุฑ.

## ๐ ุงูููููุงุช ุงูุฑุฆูุณูุฉ ููุญู

### 1. ุชุญุณูู Prisma Client (`lib/prisma.ts`)
- โ ุฅุถุงูุฉ connection pooling ูุญุณู
- โ ุชุทุจูู timeout settings ููุงุณุจุฉ
- โ ุขููุฉ keep-alive ุชุนูู ูู ุฏูููุฉ
- โ ูุนุงูุฌุฉ ุฅุบูุงู ุงูุงุชุตุงู ุจุดูู ุตุญูุญ
- โ ุฏุงูุฉ `executeWithRetry` ูุฅุนุงุฏุฉ ุงููุญุงููุฉ ุชููุงุฆูุงู

### 2. ูุธุงู Cache ููุชุตูููุงุช (`lib/services/categoriesCache.ts`)
- โ ุชุฎุฒูู ุงูุชุตูููุงุช ูู ุงูุฐุงูุฑุฉ ููุฏุฉ 5 ุฏูุงุฆู
- โ grace period ููุฏุฉ ุณุงุนุฉ ููุณูุงุญ ุจุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุฏููุฉ
- โ ุชุญุฏูุซ ุชููุงุฆู ููู cache
- โ fallback ููุจูุงูุงุช ุงููุฎุฒูุฉ ุนูุฏ ุงููุทุงุน ุงูุงุชุตุงู

### 3. ูุฏูุฑ ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช (`lib/db-connection-manager.ts`)
- โ ูุฑุงูุจุฉ ูุณุชูุฑุฉ ูุญุงูุฉ ุงูุงุชุตุงู
- โ ุฅุนุงุฏุฉ ุงุชุตุงู ุชููุงุฆูุฉ ุนูุฏ ุงูุงููุทุงุน
- โ ุฅุญุตุงุฆูุงุช ููุตูุฉ ุนู ุงูุงุชุตุงู
- โ ุชูููุฐ ุขูู ููุงุณุชุนูุงูุงุช ูุน ุถูุงู ุงูุงุชุตุงู

### 4. Health Check Endpoint (`app/api/health/db/route.ts`)
- โ ูุญุต ุดุงูู ูุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุนูููุงุช ุนู cache ุงูุชุตูููุงุช
- โ ุฅุญุตุงุฆูุงุช ุงูุงุชุตุงู ูุงูุฃุฏุงุก
- โ ูุนูููุงุช ุงูุจูุฆุฉ ูุงูุฐุงูุฑุฉ

### 5. ุชุญุณูู APIs
- โ ุงุณุชุฎุฏุงู `dbConnectionManager` ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช
- โ ูุนุงูุฌุฉ ูุญุณูุฉ ููุฃุฎุทุงุก
- โ ุงุณุชุฎุฏุงู cache ุงูุชุตูููุงุช ูุชูููู ุงูุถุบุท
- โ ุฅุฑุฌุงุน ุจูุงูุงุช ููุงุณุจุฉ ุญุชู ุนูุฏ ูุฌูุฏ ูุดุงูู

## ๐ง ููููุฉ ุงููุฑุงูุจุฉ

### 1. ูุญุต ุตุญุฉ ุงููุธุงู
```bash
curl https://sabq.io/api/health/db
```

### 2. ูุฑุงูุจุฉ ุงูุณุฌูุงุช
ุงุจุญุซ ุนู ุงูุฑุณุงุฆู ุงูุชุงููุฉ ูู ุงูุณุฌูุงุช:
- `โ Keep-alive query ุชู ุจูุฌุงุญ` - ุงูุงุชุตุงู ูุดุท
- `โ ุชู ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจูุฌุงุญ` - ุชูุช ุฅุนุงุฏุฉ ุงูุงุชุตุงู
- `โ๏ธ ุงุณุชุฎุฏุงู cache ูุฏูู` - ูุชู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ

### 3. ุชุญุฏูุซ cache ุงูุชุตูููุงุช ูุฏููุงู
```bash
curl https://sabq.io/api/categories?refresh=true
```

## ๐ ูุคุดุฑุงุช ุงููุฌุงุญ

1. **Uptime**: ูุฌุจ ุฃู ูููู ุฃูุซุฑ ูู 95%
2. **Response Time**: ุฃูู ูู 100ms ููุชุตูููุงุช ูู cache
3. **Error Rate**: ุฃูู ูู 1%
4. **Cache Hit Rate**: ุฃูุซุฑ ูู 80%

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

1. **ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ**:
   - ุงูุชุฃูุฏ ูู ุตุญุฉ `DATABASE_URL`
   - ุงูุชุฃูุฏ ูู ูุฌูุฏ SSL ูู ุงูุงุชุตุงู

2. **ูุญุต ุงูู Health Check**:
   - ุฅุฐุง ูุงู `connectionStatus` = `disconnected`ุ ูููุงู ูุดููุฉ ูู ุงูุงุชุตุงู
   - ุฅุฐุง ูุงู `uptimePercent` ููุฎูุถุ ูููุงู ุงููุทุงุนุงุช ูุชูุฑุฑุฉ

3. **ูุฑุงุฌุนุฉ ุงูุณุฌูุงุช**:
   - ุงุจุญุซ ุนู `errorDetails` ูู health check
   - ุฑุงุฌุน ุฑุณุงุฆู ุงูุฎุทุฃ ูู ุงูุณุฌูุงุช

4. **ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ**:
   - ูู ุญุงูุงุช ูุงุฏุฑุฉุ ูุฏ ุชุญุชุงุฌ ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู

## ๐ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ

1. **ุฃุณุจูุนูุงู**: ูุฑุงุฌุนุฉ ุฅุญุตุงุฆูุงุช health check
2. **ุดูุฑูุงู**: ุชุญููู ุฃุฏุงุก cache ุงูุชุตูููุงุช
3. **ุฑุจุน ุณููู**: ูุฑุงุฌุนุฉ ุฅุนุฏุงุฏุงุช timeout ูconnection pool

## ๐ ููุงุญุธุงุช ูููุฉ

- ุงูุญู ูุนูู ุจุดูู ุชููุงุฆู ููุง ูุญุชุงุฌ ุชุฏุฎู ูุฏูู
- ุงูุจูุงูุงุช ุงููุฎุฒูุฉ (cache) ุขููุฉ ููุงุณุชุฎุฏุงู ุญุชู ุณุงุนุฉ ูุงููุฉ
- ุงููุธุงู ูุนูุฏ ุงููุญุงููุฉ 3 ูุฑุงุช ูุจู ุงููุดู ุงูููุงุฆู
- Keep-alive ูููุน ูุทุน ุงูุงุชุตุงู ูู ูุจู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

- โ ูุง ูุฒูุฏ ูู ุงููุทุงุน ุงูุฎุฏูุฉ ุจุณุจุจ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ููุชุตูููุงุช ูู cache
- โ ุงุณุชูุฑุงุฑ ูุงูู ูู ูุธุงู ุงูุฃุฎุจุงุฑ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ ุฏูู ุงููุทุงุน 