# نظام الأدوار والصلاحيات المتقدم

## نظرة عامة

تم تطوير نظام أدوار وصلاحيات متقدم وقابل للتوسع يتيح التحكم الدقيق في صلاحيات المستخدمين عبر جميع وحدات النظام.

## المميزات الرئيسية

### 1. إدارة الأدوار المخصصة
- ✅ إنشاء أدوار جديدة بأسماء وأوصاف مخصصة
- ✅ تحديد لون مميز لكل دور للتمييز البصري
- ✅ حماية أدوار النظام الأساسية من الحذف
- ✅ تعديل الأدوار الموجودة
- ✅ حذف الأدوار غير المستخدمة

### 2. نظام الصلاحيات الشامل
يغطي النظام جميع وحدات CMS بما في ذلك:

#### 📰 إدارة المقالات
- `articles.create` - إنشاء المقالات
- `articles.edit` - تعديل المقالات
- `articles.delete` - حذف المقالات
- `articles.publish` - نشر المقالات
- `articles.schedule` - جدولة النشر
- `articles.review` - مراجعة المقالات

#### 📥 استلام من المراسلين
- `submissions.view` - عرض مقالات المراسلين
- `submissions.approve` - قبول/رفض المقالات
- `submissions.comment` - إضافة ملاحظات

#### 🧠 الذكاء الاصطناعي
- `ai.generate` - توليد محتوى بالذكاء الاصطناعي
- `ai.enhance` - تحسين المحتوى بالذكاء الاصطناعي
- `ai.analyze` - تحليل عميق بالذكاء الاصطناعي

#### 📊 التحليلات والتقارير
- `analytics.view_own` - عرض إحصائياتي
- `analytics.view_all` - عرض جميع الإحصائيات
- `analytics.export` - تصدير التقارير

#### 📅 تقويم سبق
- `calendar.view` - عرض التقويم
- `calendar.edit` - تعديل المهام
- `calendar.assign` - تخصيص المهام

#### 🧩 البلوكات الذكية
- `blocks.create` - إنشاء بلوك
- `blocks.edit` - تعديل البلوكات
- `blocks.delete` - حذف البلوكات
- `blocks.reorder` - ترتيب البلوكات

#### 👥 إدارة الفريق
- `team.view` - عرض الفريق
- `team.add` - إضافة عضو
- `team.edit` - تعديل صلاحيات
- `team.remove` - حذف عضو

#### 📋 سجلات النظام
- `logs.view` - عرض السجلات
- `logs.export` - تصدير السجلات
- `logs.filter` - فلترة السجلات

#### ⚙️ إعدادات النظام
- `settings.view` - عرض الإعدادات
- `settings.edit` - تعديل الإعدادات

#### 💬 التعليقات
- `comments.moderate` - إدارة التعليقات
- `comments.reply` - الرد على التعليقات

#### 🖼️ الوسائط
- `media.upload` - رفع الوسائط
- `media.manage` - إدارة الوسائط

#### 🎨 القوالب
- `templates.edit` - تعديل القوالب
- `templates.create` - إنشاء قوالب

## الأدوار الافتراضية

### 1. مدير النظام (admin)
- **اللون**: أحمر (#DC2626)
- **الوصف**: صلاحيات كاملة على جميع أجزاء النظام
- **الصلاحيات**: جميع الصلاحيات

### 2. مدير المحتوى (content-manager)
- **اللون**: أزرق (#4B82F2)
- **الوصف**: مدير المحتوى مسؤول عن استقبال الأخبار من المراسلين، مراجعتها، تعديلها، ومن ثم نشرها رسميًا في الصحيفة
- **الصلاحيات الرئيسية**:
  - إدارة كاملة للمقالات
  - استقبال ومراجعة مقالات المراسلين
  - استخدام أدوات الذكاء الاصطناعي
  - عرض الإحصائيات الخاصة
  - إدارة الوسائط

### 3. محرر (editor)
- **اللون**: أخضر (#10B981)
- **الوصف**: يمكنه كتابة وتعديل المقالات ولكن يحتاج موافقة للنشر
- **الصلاحيات الرئيسية**:
  - إنشاء وتعديل المقالات
  - استخدام أدوات AI
  - رفع الوسائط

### 4. مراجع (reviewer)
- **اللون**: برتقالي (#F59E0B)
- **الوصف**: يراجع المقالات ويضع الملاحظات ولكن لا يمكنه النشر مباشرة
- **الصلاحيات الرئيسية**:
  - مراجعة المقالات
  - عرض مقالات المراسلين
  - إضافة التعليقات والملاحظات

### 5. مراسل (correspondent)
- **اللون**: بنفسجي (#8B5CF6)
- **الوصف**: يرسل الأخبار والمقالات للمراجعة
- **الصلاحيات الرئيسية**:
  - إنشاء المقالات
  - رفع الوسائط
  - عرض إحصائياته

## واجهة إدارة الأدوار

### الصفحة الرئيسية `/dashboard/roles`
- عرض جميع الأدوار مع إحصائيات
- إمكانية البحث والفلترة
- إضافة أدوار جديدة
- تعديل وحذف الأدوار

### مميزات الواجهة
- **تصميم متجاوب**: يعمل على جميع الأجهزة
- **الوضع الليلي**: دعم كامل للوضع الليلي
- **واجهة سهلة**: تصنيف الصلاحيات حسب الفئات
- **معاينة فورية**: عرض عدد الصلاحيات المختارة
- **حماية البيانات**: منع حذف الأدوار المرتبطة بمستخدمين

## واجهة فريق العمل

### التحديثات في `/dashboard/team`
- **اختيار الدور فقط**: عند إضافة عضو جديد، يتم اختيار الدور فقط
- **الصلاحيات التلقائية**: يحصل العضو على جميع صلاحيات الدور المختار
- **عرض وصف الدور**: عرض تفاصيل الدور عند اختياره
- **البحث الذكي**: البحث في المستخدمين بالاسم أو البريد

## التخزين والبيانات

### ملفات البيانات
- `/data/roles.json` - تخزين الأدوار
- `/data/team-members.json` - تخزين أعضاء الفريق

### هيكل البيانات

#### Role
```typescript
interface Role {
  id: string;
  name: string;
  description: string;
  color: string;
  permissions: string[];
  createdAt: string;
  updatedAt: string;
  isSystem?: boolean;
  users?: number;
}
```

#### TeamMember
```typescript
interface TeamMember {
  id: string;
  userId: string;
  roleId: string;
  department: string;
  joinDate: string;
  status: 'active' | 'inactive' | 'pending';
}
```

## API Endpoints

### الأدوار
- `GET /api/roles` - جلب جميع الأدوار
- `POST /api/roles` - إنشاء دور جديد
- `GET /api/roles/[id]` - جلب دور محدد
- `PATCH /api/roles/[id]` - تحديث دور
- `DELETE /api/roles/[id]` - حذف دور

### أعضاء الفريق
- `GET /api/team-members` - جلب جميع الأعضاء
- `POST /api/team-members` - إضافة عضو جديد
- `PUT /api/team-members?id=[id]` - تحديث عضو
- `DELETE /api/team-members?id=[id]` - حذف عضو

## الأمان والحماية

1. **حماية أدوار النظام**: لا يمكن حذف الأدوار الأساسية
2. **التحقق من التبعيات**: منع حذف دور مرتبط بمستخدمين
3. **منع التكرار**: التحقق من عدم تكرار أسماء الأدوار
4. **التحقق من الصلاحيات**: التأكد من صحة معرفات الصلاحيات

## التوسع المستقبلي

يمكن توسيع النظام بسهولة عبر:
1. إضافة صلاحيات جديدة في `types/roles.ts`
2. إضافة فئات جديدة للصلاحيات
3. تطوير واجهات متخصصة لكل دور
4. ربط النظام بقاعدة بيانات
5. إضافة نظام تسلسل هرمي للأدوار 